<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Leer Nederlands ‚Äî Dutch for Thai Speakers</title>
<link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:wght@400;600;700;800&family=Nunito:wght@400;500;600;700;800&family=Sarabun:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Nunito', 'Sarabun', -apple-system, sans-serif;
    background: #FAFAF8;
    color: #333;
    min-height: 100vh;
  }
  .container { max-width: 720px; margin: 0 auto; padding: 0 16px 60px; }
  .serif { font-family: 'Source Serif 4', Georgia, serif; }

  /* Header */
  .header {
    background: linear-gradient(135deg, #1B3A5C 0%, #21468B 50%, #2E5DA8 100%);
    margin: 0 -16px; padding: 40px 24px 32px;
    border-radius: 0 0 20px 20px; color: #fff; text-align: center;
    position: relative; overflow: hidden;
  }
  .flag {
    width: 48px; height: 32px; border-radius: 4px; overflow: hidden;
    margin: 0 auto 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    display: flex; flex-direction: column;
  }
  .flag div:nth-child(1) { background: #AE1C28; height: 33.3%; }
  .flag div:nth-child(2) { background: #FFFFFF; height: 33.3%; }
  .flag div:nth-child(3) { background: #21468B; height: 33.3%; }
  .header h1 { font-size: 32px; font-weight: 800; letter-spacing: -0.5px; margin-bottom: 6px; }
  .header .sub { font-size: 15px; opacity: 0.9; margin-bottom: 4px; }
  .header .sub2 { font-size: 14px; opacity: 0.7; }

  /* Cards */
  .card {
    background: #fff; border-radius: 12px; padding: 16px 20px;
    margin: 20px 0; box-shadow: 0 1px 4px rgba(0,0,0,0.06);
  }
  .card-accent {
    background: #FFF8F0; border: 1px solid #F5DEC0;
    border-radius: 12px; padding: 18px 20px; margin: 0 0 24px;
  }
  .card-blue {
    background: #F0F7FF; border: 1px solid #D0E3F5;
    border-radius: 12px; padding: 20px 24px; margin: 0 0 24px;
  }

  /* Progress */
  .progress-bar { height: 8px; background: #eee; border-radius: 4px; overflow: hidden; }
  .progress-fill {
    height: 100%; border-radius: 4px;
    background: linear-gradient(90deg, #E85D26, #F39C12);
    transition: width 0.5s ease;
  }

  /* Module Grid */
  .module-grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 14px; margin-bottom: 24px;
  }
  .module-card {
    background: #fff; border: 1px solid #e8e8e8; border-radius: 12px;
    padding: 20px 16px; cursor: pointer; text-align: left;
    transition: all 0.2s ease; box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    display: block; width: 100%; font-family: inherit;
  }
  .module-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
  .module-card .icon { font-size: 36px; margin-bottom: 8px; }
  .module-card h3 { color: #222; font-size: 17px; margin-bottom: 2px; }
  .module-card .en { color: #666; font-size: 13px; margin-bottom: 8px; }
  .module-card .meta { font-size: 12px; font-weight: 600; }

  /* Search */
  .search-toggle {
    width: 100%; padding: 12px; background: #fff; border: 1px solid #e0e0e0;
    border-radius: 10px; font-size: 14px; cursor: pointer; color: #555;
    font-family: inherit; margin-bottom: 20px;
  }
  .search-input {
    width: 100%; padding: 12px 16px; border: 2px solid #21468B;
    border-radius: 10px; font-size: 15px; outline: none; font-family: inherit;
    margin-bottom: 4px;
  }
  .search-results {
    background: #fff; border: 1px solid #e0e0e0; border-radius: 10px;
    max-height: 300px; overflow: auto; margin-bottom: 20px;
  }
  .search-results .item {
    padding: 10px 16px; border-bottom: 1px solid #f0f0f0; font-size: 14px;
  }
  .search-results .item .detail { font-size: 12px; color: #999; }

  /* Lesson list */
  .lesson-list { display: flex; flex-direction: column; gap: 10px; }
  .lesson-card {
    background: #fff; border: 1px solid #e8e8e8; border-radius: 12px;
    padding: 16px 20px; cursor: pointer; display: flex;
    justify-content: space-between; align-items: center;
    font-family: inherit; box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    width: 100%;
  }
  .lesson-card:hover { box-shadow: 0 3px 10px rgba(0,0,0,0.08); }
  .lesson-card .num {
    width: 40px; height: 40px; border-radius: 50%;
    color: #fff; display: flex; align-items: center; justify-content: center;
    font-weight: 700; font-size: 16px; flex-shrink: 0;
  }

  /* Back button */
  .back-btn {
    background: none; border: none; color: #21468B; font-weight: 600;
    cursor: pointer; font-size: 15px; padding: 20px 0 12px; font-family: inherit;
  }
  .back-btn:hover { text-decoration: underline; }

  /* Module header */
  .module-header {
    background: #fff; border-radius: 12px; padding: 24px;
    margin-bottom: 20px; text-align: center;
    box-shadow: 0 1px 4px rgba(0,0,0,0.06);
  }
  .module-header .icon { font-size: 48px; }

  /* Tabs */
  .tabs { display: flex; gap: 6px; margin: 16px 0; overflow-x: auto; padding-bottom: 4px; }
  .tab {
    padding: 10px 16px; border-radius: 20px; border: 1px solid #ddd;
    background: #fff; cursor: pointer; font-size: 13px; font-weight: 500;
    white-space: nowrap; font-family: inherit; color: #555; transition: all 0.2s;
  }
  .tab:hover { background: #f0f0f0; }
  .tab.active { color: #fff; font-weight: 600; border-color: transparent; }

  /* Vocab */
  .vocab-grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;
  }
  .vocab-card {
    background: #fff; border: 1px solid #eee; border-radius: 10px;
    padding: 14px 16px; box-shadow: 0 1px 2px rgba(0,0,0,0.03);
    transition: transform 0.15s;
  }
  .vocab-card:hover { transform: scale(1.02); }
  .vocab-card .nl { font-size: 20px; font-weight: 700; margin-bottom: 4px; }
  .vocab-card .phonetic { font-size: 13px; color: #888; margin-bottom: 6px; }
  .vocab-card .en { font-size: 15px; font-weight: 500; color: #333; margin-bottom: 4px; }
  .vocab-card .thai { font-size: 14px; color: #999; }
  .vocab-card .note { font-size: 12px; color: #aaa; margin-top: 6px; font-style: italic; line-height: 1.4; }

  /* Dialogue */
  .dialogue-box {
    background: #fff; border-radius: 12px; padding: 20px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.06);
    display: flex; flex-direction: column; gap: 10px;
  }
  .dialogue-line {
    padding: 12px 16px; border-radius: 10px; max-width: 85%;
  }
  .dialogue-line.you { align-self: flex-end; background: #E8F4FD; border-left: 3px solid var(--mod-color); }
  .dialogue-line.other { align-self: flex-start; background: #F5F5F5; border-left: 3px solid #ddd; }
  .dialogue-line .speaker {
    font-size: 11px; font-weight: 700; margin-bottom: 4px;
    text-transform: uppercase; letter-spacing: 1px;
  }
  .dialogue-line .nl-text { font-size: 16px; font-weight: 600; color: #222; margin-bottom: 4px; }
  .dialogue-line .en-text { font-size: 14px; color: #666; }

  /* Grammar */
  .grammar-box {
    background: #fff; border-radius: 12px; padding: 24px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.06);
  }
  .grammar-example {
    background: #F8F9FA; border-radius: 8px; padding: 12px 16px;
    border-left: 3px solid #21468B; margin-top: 10px;
  }
  .grammar-example .nl { font-weight: 600; color: #222; font-size: 15px; }
  .grammar-example .en { color: #666; font-size: 14px; }

  /* Exercises */
  .exercise-card {
    background: #fff; border-radius: 12px; padding: 18px 20px;
    margin-bottom: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    border-left: 4px solid #ddd;
  }
  .exercise-card.correct { border-left-color: #5E9B4E; }
  .exercise-card.wrong { border-left-color: #E74C3C; }
  .exercise-card .question { font-weight: 600; color: #333; margin-bottom: 12px; font-size: 15px; }
  .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .option-btn {
    padding: 12px 14px; border-radius: 8px; border: 2px solid #e0e0e0;
    background: #FAFAFA; cursor: pointer; font-size: 14px; font-family: inherit;
    text-align: center; transition: all 0.15s; font-weight: 500;
  }
  .option-btn:hover:not(:disabled) { background: #f0f0f0; border-color: #bbb; }
  .option-btn.selected { border-color: var(--mod-color); background: color-mix(in srgb, var(--mod-color) 12%, white); color: var(--mod-color); }
  .option-btn.opt-correct { background: #E8F8E8; border-color: #5E9B4E; color: #2E7D32; }
  .option-btn.opt-wrong { background: #FFEBEE; border-color: #E74C3C; color: #C62828; }
  .option-btn:disabled { cursor: default; }

  .check-btn {
    width: 100%; padding: 16px; border-radius: 12px; border: none;
    color: #fff; font-size: 16px; font-weight: 700; cursor: pointer;
    margin-top: 12px; font-family: inherit; transition: all 0.2s;
  }
  .check-btn:disabled { background: #ccc !important; cursor: default; }

  .score-card {
    border-radius: 12px; padding: 24px; text-align: center;
    margin-bottom: 20px; border: 2px solid;
  }
  .score-card.pass { background: #E8F8E8; border-color: #5E9B4E; }
  .score-card.fail { background: #FFF3E0; border-color: #F39C12; }
  .score-card .score { font-size: 32px; font-weight: 800; }
  .score-card .msg { font-size: 15px; color: #555; margin-top: 4px; }

  .retry-btn {
    margin-top: 12px; padding: 10px 24px; border-radius: 8px;
    border: none; color: #fff; font-size: 14px; font-weight: 600;
    cursor: pointer; font-family: inherit;
  }

  /* Audio buttons */
  .speak-btn {
    display: inline-flex; align-items: center; justify-content: center;
    width: 32px; height: 32px; border-radius: 50%; border: 2px solid #ddd;
    background: #FAFAFA; cursor: pointer; font-size: 16px;
    transition: all 0.2s; flex-shrink: 0; padding: 0;
  }
  .speak-btn:hover { background: #E8F4FD; border-color: #2E86AB; transform: scale(1.1); }
  .speak-btn.speaking { background: #E8F4FD; border-color: #2E86AB; animation: pulse-speak 1s infinite; }
  @keyframes pulse-speak { 0%,100% { transform: scale(1); } 50% { transform: scale(1.15); } }
  .speak-btn-sm { width: 26px; height: 26px; font-size: 13px; }
  .vocab-card-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 8px; }
  .dialogue-line-header { display: flex; justify-content: space-between; align-items: center; }

  /* Listen tab */
  .listen-card {
    background: #fff; border: 1px solid #eee; border-radius: 10px;
    padding: 14px 16px; display: flex; align-items: center; gap: 14px;
    cursor: pointer; transition: all 0.15s;
  }
  .listen-card:hover { background: #F8FBFF; border-color: #ccc; }
  .listen-card.active-word { background: #E8F4FD; border-color: #2E86AB; }
  .listen-controls {
    background: #fff; border-radius: 12px; padding: 18px 20px; margin-bottom: 16px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.06); display: flex; flex-wrap: wrap;
    gap: 10px; align-items: center;
  }
  .listen-btn {
    padding: 10px 20px; border-radius: 8px; border: 2px solid; cursor: pointer;
    font-size: 14px; font-weight: 600; font-family: inherit; transition: all 0.2s;
  }
  .listen-btn:hover { transform: translateY(-1px); }
  .speed-control { display: flex; align-items: center; gap: 6px; margin-left: auto; }
  .speed-btn {
    padding: 6px 12px; border-radius: 6px; border: 1px solid #ddd;
    background: #f5f5f5; cursor: pointer; font-size: 13px; font-family: inherit;
    font-weight: 600; transition: all 0.15s;
  }
  .speed-btn.active-speed { background: #21468B; color: #fff; border-color: #21468B; }
  .listen-list { display: flex; flex-direction: column; gap: 6px; }

  /* Voice selector */
  .voice-selector {
    background: #fff; border-radius: 12px; padding: 16px 20px; margin-bottom: 12px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.06); border: 1px solid #e8e8e8;
  }
  .voice-selector label { font-weight: 600; font-size: 14px; color: #333; display: block; margin-bottom: 8px; }
  .voice-select {
    width: 100%; padding: 10px 14px; border-radius: 8px; border: 2px solid #ddd;
    font-size: 14px; font-family: inherit; background: #FAFAFA;
    cursor: pointer; appearance: auto; color: #333;
  }
  .voice-select:focus { border-color: #21468B; outline: none; }
  .voice-info { font-size: 12px; color: #888; margin-top: 8px; line-height: 1.5; }
  .voice-test-btn {
    margin-top: 8px; padding: 6px 14px; border-radius: 6px; border: 1px solid #ddd;
    background: #f8f8f8; cursor: pointer; font-size: 13px; font-family: inherit;
    transition: all 0.15s;
  }
  .voice-test-btn:hover { background: #E8F4FD; border-color: #2E86AB; }
  .no-voices-warning {
    background: #FFF3E0; border: 1px solid #F5DEC0; border-radius: 10px;
    padding: 14px 16px; margin-bottom: 16px; font-size: 14px; color: #555; line-height: 1.6;
  }

  /* Tips */
  .tip { margin-bottom: 8px; font-size: 14px; line-height: 1.7; color: #555; }
  .tip:last-child { margin-bottom: 0; }

  .hidden { display: none; }

  @media (max-width: 500px) {
    .module-grid { grid-template-columns: 1fr; }
    .vocab-grid { grid-template-columns: 1fr; }
    .options-grid { grid-template-columns: 1fr; }
    .header h1 { font-size: 26px; }
  }
</style>
</head>
<body>

<div class="container" id="app"></div>

<script>
// ============================================================
// COURSE DATA
// ============================================================
const COURSE_DATA = {
  sections: [
    {
      id: "taal", title: "Taal ¬∑ ‡∏†‡∏≤‡∏©‡∏≤", titleEn: "Language A1", icon: "üá≥üá±", color: "#21468B",
      description: "Dutch language lessons based on the official Naar Nederland curriculum (Les 21-65)",
      descriptionTh: "‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏î‡∏±‡∏ï‡∏ä‡πå‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£ Naar Nederland (‡∏ö‡∏ó‡∏ó‡∏µ‡πà 21-65)"
    },
    {
      id: "kns", title: "KNS ¬∑ ‡∏™‡∏±‡∏á‡∏Ñ‡∏°", titleEn: "Dutch Society", icon: "üèõÔ∏è", color: "#E85D26",
      description: "Kennis van de Nederlandse Samenleving ‚Äî 100 questions about Dutch society",
      descriptionTh: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏î‡∏±‡∏ï‡∏ä‡πå ‚Äî 100 ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏î‡∏±‡∏ï‡∏ä‡πå"
    },
    {
      id: "uitspraak", title: "Uitspraak ¬∑ ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á", titleEn: "Pronunciation", icon: "üó£Ô∏è", color: "#5E9B4E",
      description: "Dutch sounds and pronunciation for Thai speakers (based on Les 1-4 & 20)",
      descriptionTh: "‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏†‡∏≤‡∏©‡∏≤‡∏î‡∏±‡∏ï‡∏ä‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡πÑ‡∏ó‡∏¢ (‡∏à‡∏≤‡∏Å‡∏ö‡∏ó‡∏ó‡∏µ‡πà 1-4 ‡πÅ‡∏•‡∏∞ 20)"
    }
  ],
  modules: [
    // ===== SECTION A: TAAL ‚Äî Theme 1: Kennismaken (Les 21-22) =====
    {
      id: 1, section: "taal", title: "Kennismaken", titleEn: "Getting Acquainted", titleTh: "‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å", icon: "üëã", color: "#E85D26",
      source: "Les 21-22",
      lessons: [
        {
          id: "t1a", title: "Jezelf Voorstellen", titleEn: "Introducing Yourself", titleTh: "‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á",
          vocab: [
            { nl: "wat", en: "what", phonetic: "vat", thai: "‡∏≠‡∏∞‡πÑ‡∏£" },
            { nl: "is", en: "is", phonetic: "is", thai: "‡∏Ñ‡∏∑‡∏≠" },
            { nl: "uw", en: "your (formal)", phonetic: "uw", thai: "‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô, ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£)" },
            { nl: "naam", en: "name", phonetic: "nahm", thai: "‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•", note: "de naam" },
            { nl: "dag", en: "hello / goodbye", phonetic: "dakh", thai: "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ", note: "Informal, used for both" },
            { nl: "mevrouw", en: "Mrs / madam", phonetic: "muh-VROW", thai: "‡∏Ñ‡∏∏‡∏ì(‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á)", note: "de mevrouw" },
            { nl: "goedemiddag", en: "good afternoon", phonetic: "KHOO-duh-MID-dakh", thai: "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ (‡∏ï‡∏≠‡∏ô‡∏ö‡πà‡∏≤‡∏¢)" },
            { nl: "kan", en: "can", phonetic: "kan", thai: "‡πÑ‡∏î‡πâ", note: "from: kunnen" },
            { nl: "ik", en: "I", phonetic: "ik", thai: "‡∏ú‡∏°, ‡∏â‡∏±‡∏ô" },
            { nl: "u", en: "you (formal)", phonetic: "uw", thai: "‡∏ó‡πà‡∏≤‡∏ô, ‡∏Ñ‡∏∏‡∏ì (‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£)" },
            { nl: "helpen", en: "to help", phonetic: "HEL-pun", thai: "‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠" },
            { nl: "wil", en: "want", phonetic: "vil", thai: "‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£", note: "from: willen" },
            { nl: "mij", en: "me", phonetic: "mey", thai: "‡∏ú‡∏°‡πÄ‡∏≠‡∏á, ‡∏â‡∏±‡∏ô‡πÄ‡∏≠‡∏á" },
            { nl: "graag", en: "gladly / please", phonetic: "khrahkh", thai: "‡∏≠‡∏¢‡∏≤‡∏Å‡∏à‡∏∞" },
            { nl: "inschrijven", en: "to register", phonetic: "IN-skhrey-vun", thai: "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô" },
            { nl: "goed", en: "good", phonetic: "khoot", thai: "‡πÑ‡∏î‡πâ" },
            { nl: "mijn", en: "my", phonetic: "meyn", thai: "‡∏Ç‡∏≠‡∏á‡∏ú‡∏°, ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô" },
            { nl: "waar", en: "where", phonetic: "vahr", thai: "‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô" },
            { nl: "woont", en: "live (conjugated)", phonetic: "vohnt", thai: "‡∏≠‡∏¢‡∏π‡πà", note: "from: wonen" },
            { nl: "in", en: "in", phonetic: "in", thai: "‡πÉ‡∏ô" },
            { nl: "en", en: "and", phonetic: "en", thai: "‡πÅ‡∏•‡∏∞" },
            { nl: "adres", en: "address", phonetic: "ah-DRES", thai: "‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà", note: "het adres" },
            { nl: "postcode", en: "postal code", phonetic: "POST-koh-duh", thai: "‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå", note: "de postcode" },
            { nl: "telefoon", en: "telephone", phonetic: "tay-luh-FOHN", thai: "‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå", note: "de telefoon" },
            { nl: "nummer", en: "number", phonetic: "NUM-mur", thai: "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç", note: "het nummer" },
            { nl: "mobiel", en: "mobile phone", phonetic: "moh-BEEL", thai: "‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠" },
            { nl: "makkelijk", en: "easy", phonetic: "MAK-kuh-luk", thai: "‡∏á‡πà‡∏≤‡∏¢" },
            { nl: "moeilijk", en: "difficult", phonetic: "MOO-ee-luk", thai: "‡∏¢‡∏≤‡∏Å" },
          ],
          dialogues: [
            { situation: "At the registration desk (Les 21)", lines: [
              { speaker: "A", nl: "Goedemiddag mevrouw, kan ik u helpen?", en: "Good afternoon madam, can I help you?" },
              { speaker: "B", nl: "Ja, ik wil mij graag inschrijven.", en: "Yes, I would like to register." },
              { speaker: "A", nl: "Goed. Wat is uw naam?", en: "Good. What is your name?" },
              { speaker: "B", nl: "Mijn naam is Siriporn Jansen.", en: "My name is Siriporn Jansen." },
              { speaker: "A", nl: "En waar woont u?", en: "And where do you live?" },
              { speaker: "B", nl: "Ik woon in Rotterdam.", en: "I live in Rotterdam." },
            ]}
          ],
          grammar: {
            title: "Formal vs Informal 'You'",
            explanation: "Dutch has two forms of 'you': <strong>jij/je</strong> (informal, for friends/family) and <strong>u</strong> (formal, for strangers/officials). In Les 21, everyone uses <em>u</em> because it's a registration desk. Think of it like Thai's ‡∏Ñ‡∏∏‡∏ì ‚Äî always use <em>u</em> when you're not sure.",
            examples: [
              { nl: "Wat is uw naam?", en: "What is your name? (formal)" },
              { nl: "Waar woont u?", en: "Where do you live? (formal)" },
              { nl: "Kan ik u helpen?", en: "Can I help you? (formal)" },
            ]
          },
          exercises: [
            { type: "mc", question: "How do you say 'I would like to register'?", answer: "Ik wil mij graag inschrijven", options: ["Ik wil mij graag inschrijven", "Ik woon in Rotterdam", "Wat is uw naam?", "Kan ik u helpen?"] },
            { type: "mc", question: "What does 'waar' mean?", answer: "where", options: ["what", "where", "who", "when"] },
            { type: "mc", question: "Fill in: Wat is ___ naam?", answer: "uw", options: ["uw", "mijn", "je", "de"] },
            { type: "mc", question: "'Makkelijk' is the opposite of...?", answer: "moeilijk", options: ["goed", "graag", "moeilijk", "waar"] },
            { type: "mc", question: "What is 'de postcode' in English?", answer: "postal code", options: ["post office", "postal code", "postcard", "phone number"] },
          ]
        },
        {
          id: "t1b", title: "Nummers & Vragen", titleEn: "Numbers & Questions", titleTh: "‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°",
          vocab: [
            { nl: "nul", en: "zero", phonetic: "nul", thai: "‡∏®‡∏π‡∏ô‡∏¢‡πå" },
            { nl: "√©√©n", en: "one", phonetic: "ayn", thai: "‡∏´‡∏ô‡∏∂‡πà‡∏á" },
            { nl: "twee", en: "two", phonetic: "tvay", thai: "‡∏™‡∏≠‡∏á" },
            { nl: "drie", en: "three", phonetic: "dree", thai: "‡∏™‡∏≤‡∏°" },
            { nl: "vier", en: "four", phonetic: "veer", thai: "‡∏™‡∏µ‡πà" },
            { nl: "vijf", en: "five", phonetic: "veyf", thai: "‡∏´‡πâ‡∏≤" },
            { nl: "zes", en: "six", phonetic: "zes", thai: "‡∏´‡∏Å" },
            { nl: "zeven", en: "seven", phonetic: "ZAY-vun", thai: "‡πÄ‡∏à‡πá‡∏î" },
            { nl: "acht", en: "eight", phonetic: "akht", thai: "‡πÅ‡∏õ‡∏î" },
            { nl: "negen", en: "nine", phonetic: "NAY-khun", thai: "‡πÄ‡∏Å‡πâ‡∏≤" },
            { nl: "tien", en: "ten", phonetic: "teen", thai: "‡∏™‡∏¥‡∏ö" },
            { nl: "hoe", en: "how", phonetic: "hoo", thai: "‡∏≠‡∏∞‡πÑ‡∏£" },
            { nl: "heet", en: "am called", phonetic: "hayt", thai: "‡∏ä‡∏∑‡πà‡∏≠", note: "from: heten" },
            { nl: "ben", en: "am", phonetic: "ben", thai: "‡∏≠‡∏¢‡∏π‡πà", note: "from: zijn" },
            { nl: "vragen", en: "questions", phonetic: "VRAH-khun", thai: "‡∏ñ‡∏≤‡∏°", note: "de vragen" },
            { nl: "kennen", en: "to know (someone)", phonetic: "KEN-nun", thai: "‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å" },
            { nl: "wij", en: "we", phonetic: "vey", thai: "‡∏û‡∏ß‡∏Å‡πÄ‡∏£‡∏≤" },
            { nl: "elkaar", en: "each other", phonetic: "el-KAHR", thai: "‡∏Å‡∏±‡∏ô" },
            { nl: "niet", en: "not", phonetic: "neet", thai: "‡πÑ‡∏°‡πà" },
            { nl: "jij", en: "you (informal)", phonetic: "yey", thai: "‡∏Ñ‡∏∏‡∏ì (‡πÑ‡∏°‡πà‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£), ‡πÄ‡∏ò‡∏≠" },
            { nl: "je", en: "you (informal short)", phonetic: "yuh", thai: "‡∏Ñ‡∏∏‡∏ì (‡πÑ‡∏°‡πà‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£), ‡πÄ‡∏ò‡∏≠" },
            { nl: "nee", en: "no", phonetic: "nay", thai: "‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà" },
            { nl: "ja", en: "yes", phonetic: "yah", thai: "‡πÉ‡∏ä‡πà" },
            { nl: "vriend", en: "friend", phonetic: "vreent", thai: "‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô", note: "de vriend" },
            { nl: "hij", en: "he", phonetic: "hey", thai: "‡πÄ‡∏Ç‡∏≤(‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢)" },
            { nl: "alleen", en: "alone", phonetic: "ah-LAYN", thai: "‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß" },
            { nl: "vaak", en: "often", phonetic: "vahk", thai: "‡∏ö‡πà‡∏≠‡∏¢" },
            { nl: "fietsen", en: "to cycle", phonetic: "FEET-sun", thai: "‡∏Ç‡∏µ‡πà‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô", note: "Very Dutch! üö≤" },
            { nl: "met", en: "with", phonetic: "met", thai: "‡∏Å‡∏±‡∏ö" },
          ],
          dialogues: [
            { situation: "Meeting a neighbor on the street (Les 22)", lines: [
              { speaker: "A", nl: "Dag! Kennen wij elkaar niet?", en: "Hi! Don't we know each other?" },
              { speaker: "B", nl: "Ik geloof het niet. Ik ben Siriporn.", en: "I don't think so. I'm Siriporn." },
              { speaker: "A", nl: "Hoe heet jij?", en: "What's your name?" },
              { speaker: "B", nl: "Ik heet Siriporn. En jij?", en: "My name is Siriporn. And you?" },
              { speaker: "A", nl: "Ik ben Maria. Woon je hier in de straat?", en: "I'm Maria. Do you live here on the street?" },
              { speaker: "B", nl: "Ja, ik woon daar.", en: "Yes, I live there." },
            ]}
          ],
          grammar: {
            title: "Numbers 0-10 and Basic Questions",
            explanation: "Dutch numbers 0-10 are essential for phone numbers, addresses, and time. Notice: <strong>hoe heet je?</strong> (what's your name?), <strong>waar woon je?</strong> (where do you live?). Questions often start with a question word + verb + subject.",
            examples: [
              { nl: "Hoe heet je?", en: "What's your name?" },
              { nl: "Waar woon je?", en: "Where do you live?" },
              { nl: "Ken je Maria?", en: "Do you know Maria?" },
            ]
          },
          exercises: [
            { type: "mc", question: "What number is 'zeven'?", answer: "7", options: ["5", "6", "7", "8"] },
            { type: "mc", question: "How do you ask someone's name informally?", answer: "Hoe heet je?", options: ["Wat is uw naam?", "Hoe heet je?", "Wie ben jij?", "Kennen wij elkaar?"] },
            { type: "mc", question: "What does 'fietsen' mean?", answer: "to cycle", options: ["to walk", "to drive", "to cycle", "to run"] },
            { type: "mc", question: "Fill in: Kennen wij ___ niet?", answer: "elkaar", options: ["alleen", "niet", "elkaar", "samen"] },
            { type: "mc", question: "What is 'drie' + 'vijf'?", answer: "acht", options: ["zeven", "acht", "negen", "zes"] },
          ]
        }
      ]
    },
    // ===== Theme 2: Huis & Wonen (Les 23) =====
    {
      id: 2, section: "taal", title: "Huis & Wonen", titleEn: "House & Living", titleTh: "‡∏ö‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢", icon: "üè†", color: "#2E86AB",
      source: "Les 23",
      lessons: [
        {
          id: "t2a", title: "Ons Huis", titleEn: "Our House", titleTh: "‡∏ö‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤",
          vocab: [
            { nl: "huis", en: "house", phonetic: "hows", thai: "‡∏ö‡πâ‡∏≤‡∏ô", note: "het huis" },
            { nl: "deur", en: "door", phonetic: "duhr", thai: "‡∏õ‡∏£‡∏∞‡∏ï‡∏π", note: "de deur" },
            { nl: "kom binnen", en: "come in", phonetic: "kom BIN-nun", thai: "‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô" },
            { nl: "welkom", en: "welcome", phonetic: "VEL-kom", thai: "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö" },
            { nl: "woonkamer", en: "living room", phonetic: "VOHN-kah-mur", thai: "‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÅ‡∏Ç‡∏Å", note: "de woonkamer" },
            { nl: "keuken", en: "kitchen", phonetic: "KUH-kun", thai: "‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡∏ß", note: "de keuken" },
            { nl: "achter", en: "behind / at the back", phonetic: "AKH-tur", thai: "‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏á" },
            { nl: "trap", en: "stairs", phonetic: "trap", thai: "‡∏ö‡∏±‡∏ô‡πÑ‡∏î", note: "de trap" },
            { nl: "boven", en: "upstairs / above", phonetic: "BOH-vun", thai: "‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô" },
            { nl: "beneden", en: "downstairs / below", phonetic: "buh-NAY-dun", thai: "‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á" },
            { nl: "verdieping", en: "floor / storey", phonetic: "vur-DEE-ping", thai: "‡∏ä‡∏±‡πâ‡∏ô", note: "de verdieping" },
            { nl: "badkamer", en: "bathroom", phonetic: "BAT-kah-mur", thai: "‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥", note: "de badkamer" },
            { nl: "slaapkamer", en: "bedroom", phonetic: "SLAHP-kah-mur", thai: "‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏≠‡∏ô", note: "de slaapkamer" },
            { nl: "kamer", en: "room", phonetic: "KAH-mur", thai: "‡∏´‡πâ‡∏≠‡∏á", note: "de kamer" },
            { nl: "toilet", en: "toilet", phonetic: "twah-LET", thai: "‡∏™‡∏∏‡∏Ç‡∏≤", note: "het toilet" },
            { nl: "gang", en: "hallway", phonetic: "khang", thai: "‡∏´‡πâ‡∏≠‡∏á‡πÇ‡∏ñ‡∏á‡∏ï‡∏£‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏≤", note: "de gang" },
            { nl: "links", en: "left", phonetic: "links", thai: "‡∏ã‡πâ‡∏≤‡∏¢" },
            { nl: "rechts", en: "right", phonetic: "rekhts", thai: "‡∏Ç‡∏ß‡∏≤" },
            { nl: "licht", en: "light", phonetic: "likht", thai: "‡πÅ‡∏™‡∏á‡πÑ‡∏ü", note: "het licht" },
            { nl: "klein", en: "small", phonetic: "kleyn", thai: "‡πÄ‡∏•‡πá‡∏Å" },
            { nl: "eigen", en: "own", phonetic: "EY-khun", thai: "‡∏ï‡∏ô‡πÄ‡∏≠‡∏á" },
            { nl: "woning", en: "dwelling / home", phonetic: "VOH-ning", thai: "‡∏ö‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏®‡∏±‡∏¢", note: "de woning" },
            { nl: "ruimte", en: "space / room", phonetic: "ROWM-tuh", thai: "‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà", note: "de ruimte" },
            { nl: "spullen", en: "stuff / belongings", phonetic: "SPUL-lun", thai: "‡∏Ç‡πâ‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ä‡πâ", note: "de spullen" },
          ],
          dialogues: [
            { situation: "Showing your house to a visitor (Les 23)", lines: [
              { speaker: "A", nl: "Dit is ons huis. Kom binnen!", en: "This is our house. Come in!" },
              { speaker: "B", nl: "Wat een mooie woonkamer!", en: "What a beautiful living room!" },
              { speaker: "A", nl: "De keuken is achter. Ga maar mee naar boven.", en: "The kitchen is at the back. Come upstairs with me." },
              { speaker: "B", nl: "Hoeveel slaapkamers hebben jullie?", en: "How many bedrooms do you have?" },
              { speaker: "A", nl: "Drie. De kinderen hebben hun eigen kamer.", en: "Three. The children have their own room." },
            ]}
          ],
          grammar: {
            title: "Position Words & het/de Articles",
            explanation: "Dutch uses <strong>de</strong> for most nouns and <strong>het</strong> for neuter nouns. There's no easy rule ‚Äî you must memorize them. Position words are important for giving directions: <strong>boven</strong> (upstairs), <strong>beneden</strong> (downstairs), <strong>links</strong> (left), <strong>rechts</strong> (right), <strong>achter</strong> (behind).",
            examples: [
              { nl: "De keuken is achter", en: "The kitchen is at the back" },
              { nl: "Het toilet is beneden", en: "The toilet is downstairs" },
              { nl: "De badkamer is boven, links", en: "The bathroom is upstairs, on the left" },
            ]
          },
          exercises: [
            { type: "mc", question: "What is 'de keuken'?", answer: "kitchen", options: ["bedroom", "kitchen", "bathroom", "living room"] },
            { type: "mc", question: "'Boven' is the opposite of...?", answer: "beneden", options: ["links", "rechts", "beneden", "achter"] },
            { type: "mc", question: "Which article: ___ huis?", answer: "het", options: ["de", "het", "een", "die"] },
            { type: "mc", question: "What does 'slaapkamer' literally mean?", answer: "sleep room", options: ["living room", "sleep room", "wash room", "sitting room"] },
            { type: "mc", question: "Fill in: De badkamer is boven, ___", answer: "links", options: ["boven", "beneden", "links", "buiten"] },
          ]
        }
      ]
    },
    // ===== Theme 3: Seizoenen & Kalender (Les 24) =====
    {
      id: 3, section: "taal", title: "Seizoenen & Kalender", titleEn: "Seasons & Calendar", titleTh: "‡∏§‡∏î‡∏π‡∏Å‡∏≤‡∏•‡πÅ‡∏•‡∏∞‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô", icon: "üçÇ", color: "#D4A574",
      source: "Les 24",
      lessons: [
        {
          id: "t3a", title: "De Vier Seizoenen", titleEn: "The Four Seasons", titleTh: "‡∏™‡∏µ‡πà‡∏§‡∏î‡∏π",
          vocab: [
            { nl: "seizoen", en: "season", phonetic: "say-ZOON", thai: "‡∏§‡∏î‡∏π", note: "het seizoen" },
            { nl: "winter", en: "winter", phonetic: "VIN-tur", thai: "‡∏§‡∏î‡∏π‡∏´‡∏ô‡∏≤‡∏ß", note: "de winter" },
            { nl: "lente", en: "spring", phonetic: "LEN-tuh", thai: "‡∏§‡∏î‡∏π‡πÉ‡∏ö‡πÑ‡∏°‡πâ‡∏ú‡∏•‡∏¥", note: "de lente" },
            { nl: "voorjaar", en: "spring", phonetic: "VOHR-yahr", thai: "‡∏ï‡πâ‡∏ô‡∏õ‡∏µ", note: "het voorjaar ‚Äî another word for spring" },
            { nl: "zomer", en: "summer", phonetic: "ZOH-mur", thai: "‡∏§‡∏î‡∏π‡∏£‡πâ‡∏≠‡∏ô", note: "de zomer" },
            { nl: "najaar", en: "autumn", phonetic: "NAH-yahr", thai: "‡∏õ‡∏•‡∏≤‡∏¢‡∏õ‡∏µ", note: "het najaar" },
            { nl: "koud", en: "cold", phonetic: "kowt", thai: "‡∏´‡∏ô‡∏≤‡∏ß" },
            { nl: "warm", en: "warm", phonetic: "varm", thai: "‡∏≠‡∏∏‡πà‡∏ô" },
            { nl: "erg", en: "very", phonetic: "erkh", thai: "‡∏°‡∏≤‡∏Å" },
            { nl: "vandaag", en: "today", phonetic: "van-DAHKH", thai: "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ" },
            { nl: "buiten", en: "outside", phonetic: "BOW-tun", thai: "‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å" },
            { nl: "binnen", en: "inside", phonetic: "BIN-nun", thai: "‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô" },
            { nl: "jas", en: "coat", phonetic: "yas", thai: "‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡πÇ‡∏Ñ‡πâ‡∏ï", note: "de jas" },
            { nl: "weer", en: "weather", phonetic: "vayr", thai: "‡∏≠‡∏≤‡∏Å‡∏≤‡∏®", note: "het weer" },
            { nl: "regenen", en: "to rain", phonetic: "RAY-khuh-nun", thai: "‡∏ù‡∏ô‡∏ï‡∏Å" },
            { nl: "nat", en: "wet", phonetic: "nat", thai: "‡πÄ‡∏õ‡∏µ‡∏¢‡∏Å‡∏ä‡∏∑‡πâ‡∏ô" },
            { nl: "droog", en: "dry", phonetic: "drohkh", thai: "‡∏ù‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏Å" },
            { nl: "donker", en: "dark", phonetic: "DON-kur", thai: "‡∏°‡∏∑‡∏î" },
            { nl: "mooi", en: "beautiful", phonetic: "moy", thai: "‡∏™‡∏ß‡∏¢" },
            { nl: "bloemen", en: "flowers", phonetic: "BLOOM-un", thai: "‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ", note: "de bloemen" },
            { nl: "heerlijk", en: "wonderful / delightful", phonetic: "HAYR-luk", thai: "‡∏™‡∏ö‡∏≤‡∏¢‡∏î‡∏µ‡∏à‡∏£‡∏¥‡∏á‡πÜ" },
            { nl: "rood", en: "red", phonetic: "roht", thai: "‡∏™‡∏µ‡πÅ‡∏î‡∏á" },
            { nl: "geel", en: "yellow", phonetic: "khayl", thai: "‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á" },
            { nl: "bladeren", en: "leaves", phonetic: "BLAH-duh-run", thai: "‡πÉ‡∏ö‡πÑ‡∏°‡πâ", note: "het blad (singular)" },
            { nl: "hond", en: "dog", phonetic: "hont", thai: "‡∏´‡∏°‡∏≤", note: "de hond" },
            { nl: "gezellig", en: "cozy / convivial", phonetic: "khuh-ZEL-likh", thai: "‡∏£‡∏∑‡πà‡∏ô‡∏£‡∏°‡∏¢‡πå", note: "Untranslatable Dutch concept! üá≥üá±" },
          ],
          dialogues: [
            { situation: "Talking about the weather (Les 24)", lines: [
              { speaker: "A", nl: "Het is vandaag erg koud buiten!", en: "It's very cold outside today!" },
              { speaker: "B", nl: "Ja, het is winter. Doe je jas aan!", en: "Yes, it's winter. Put your coat on!" },
              { speaker: "A", nl: "In de lente wordt het warmer.", en: "In spring it gets warmer." },
              { speaker: "B", nl: "Ja, en dan komen de bloemen. Wat mooi!", en: "Yes, and then the flowers come. How beautiful!" },
            ]}
          ],
          grammar: {
            title: "Weather Expressions & 'het'",
            explanation: "Dutch uses <strong>het</strong> as an impersonal subject for weather: <em>Het regent</em> (it rains), <em>Het is koud</em> (it's cold). The word <strong>worden</strong> means 'to become': <em>Het wordt warmer</em> (it's getting warmer). Note: Thai doesn't have this ‚Äî ‡∏ù‡∏ô‡∏ï‡∏Å is literally 'rain falls' while Dutch says 'het regent' (it rains).",
            examples: [
              { nl: "Het is koud", en: "It is cold" },
              { nl: "Het regent", en: "It's raining" },
              { nl: "Het wordt warmer", en: "It's getting warmer" },
            ]
          },
          exercises: [
            { type: "mc", question: "Which season has falling red and yellow leaves?", answer: "najaar", options: ["winter", "lente", "zomer", "najaar"] },
            { type: "mc", question: "What does 'gezellig' mean?", answer: "cozy / convivial", options: ["beautiful", "cold", "cozy / convivial", "dark"] },
            { type: "mc", question: "Fill in: Het ___ vandaag erg koud.", answer: "is", options: ["is", "ben", "zijn", "heeft"] },
            { type: "mc", question: "'Nat' is the opposite of...?", answer: "droog", options: ["warm", "koud", "droog", "donker"] },
            { type: "mc", question: "What does 'het weer' mean?", answer: "the weather", options: ["the wind", "the weather", "the rain", "the sun"] },
          ]
        },
        {
          id: "t3b", title: "De Maanden", titleEn: "The Months", titleTh: "‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÜ",
          vocab: [
            { nl: "kalender", en: "calendar", phonetic: "kah-LEN-dur", thai: "‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô", note: "de kalender" },
            { nl: "januari", en: "January", phonetic: "YAN-oo-ah-ree", thai: "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°" },
            { nl: "februari", en: "February", phonetic: "FAY-broo-ah-ree", thai: "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå" },
            { nl: "maart", en: "March", phonetic: "mahrt", thai: "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°" },
            { nl: "april", en: "April", phonetic: "ah-PRIL", thai: "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô" },
            { nl: "mei", en: "May", phonetic: "mey", thai: "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°" },
            { nl: "juni", en: "June", phonetic: "YOO-nee", thai: "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô" },
            { nl: "juli", en: "July", phonetic: "YOO-lee", thai: "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°" },
            { nl: "augustus", en: "August", phonetic: "ow-KHUS-tus", thai: "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°" },
            { nl: "september", en: "September", phonetic: "sep-TEM-bur", thai: "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô" },
            { nl: "oktober", en: "October", phonetic: "ok-TOH-bur", thai: "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°" },
            { nl: "november", en: "November", phonetic: "noh-VEM-bur", thai: "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô" },
            { nl: "december", en: "December", phonetic: "day-SEM-bur", thai: "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°" },
            { nl: "school", en: "school", phonetic: "skhohl", thai: "‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", note: "de school" },
            { nl: "dicht", en: "closed", phonetic: "dikht", thai: "‡∏õ‡∏¥‡∏î" },
            { nl: "vrij", en: "free / off", phonetic: "vrey", thai: "‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" },
          ],
          dialogues: [
            { situation: "Talking about the school calendar", lines: [
              { speaker: "A", nl: "Wanneer zijn de scholen dicht?", en: "When are the schools closed?" },
              { speaker: "B", nl: "In juli en augustus. Dan is het zomer.", en: "In July and August. That's summer." },
              { speaker: "A", nl: "En wanneer begint de school weer?", en: "And when does school start again?" },
              { speaker: "B", nl: "In september.", en: "In September." },
            ]}
          ],
          grammar: {
            title: "Months & Seasons without Articles",
            explanation: "Months and seasons in Dutch are used without articles in most cases: <em>In januari is het koud</em> (In January it's cold). Unlike English, Dutch months are <strong>not capitalized</strong>. They all have <em>de</em> as their article if you need one.",
            examples: [
              { nl: "In januari is het koud", en: "In January it's cold" },
              { nl: "De zomer begint in juni", en: "Summer starts in June" },
              { nl: "In december is het donker", en: "In December it's dark" },
            ]
          },
          exercises: [
            { type: "mc", question: "Which month comes after 'maart'?", answer: "april", options: ["februari", "april", "mei", "januari"] },
            { type: "mc", question: "Schools are closed (dicht) in...?", answer: "juli en augustus", options: ["januari en februari", "maart en april", "juli en augustus", "november en december"] },
            { type: "mc", question: "How many months are there?", answer: "twaalf", options: ["tien", "elf", "twaalf", "dertien"] },
            { type: "mc", question: "'Dicht' means...?", answer: "closed", options: ["open", "closed", "far", "near"] },
            { type: "mc", question: "When does winter start in the Netherlands?", answer: "december", options: ["oktober", "november", "december", "januari"] },
          ]
        }
      ]
    },
    // ===== Theme 4: Dagen & Tijd (Les 25) =====
    {
      id: 4, section: "taal", title: "Dagen & Tijd", titleEn: "Days & Time", titleTh: "‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤", icon: "‚è∞", color: "#6B4C9A",
      source: "Les 25",
      lessons: [
        {
          id: "t4a", title: "De Dagen van de Week", titleEn: "Days of the Week", titleTh: "‡∏ß‡∏±‡∏ô‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå",
          vocab: [
            { nl: "maandag", en: "Monday", phonetic: "MAHN-dakh", thai: "‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå" },
            { nl: "dinsdag", en: "Tuesday", phonetic: "DINS-dakh", thai: "‡∏ß‡∏±‡∏ô‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£" },
            { nl: "woensdag", en: "Wednesday", phonetic: "VOONS-dakh", thai: "‡∏ß‡∏±‡∏ô‡∏û‡∏∏‡∏ò" },
            { nl: "donderdag", en: "Thursday", phonetic: "DON-dur-dakh", thai: "‡∏ß‡∏±‡∏ô‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ" },
            { nl: "vrijdag", en: "Friday", phonetic: "VREY-dakh", thai: "‡∏ß‡∏±‡∏ô‡∏®‡∏∏‡∏Å‡∏£‡πå" },
            { nl: "zaterdag", en: "Saturday", phonetic: "ZAH-tur-dakh", thai: "‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå" },
            { nl: "zondag", en: "Sunday", phonetic: "ZON-dakh", thai: "‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå" },
            { nl: "werk", en: "work", phonetic: "verk", thai: "‡∏ó‡∏≥‡∏á‡∏≤‡∏ô", note: "het werk" },
            { nl: "lerares", en: "teacher (female)", phonetic: "lay-RAH-res", thai: "‡∏Ñ‡∏£‡∏π(‡∏ú‡∏π‡πâ‡∏´‡∏ç‡∏¥‡∏á)", note: "de lerares" },
            { nl: "weekend", en: "weekend", phonetic: "WEEK-ent", thai: "‡∏™‡∏∏‡∏î‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå", note: "het weekend" },
            { nl: "soms", en: "sometimes", phonetic: "soms", thai: "‡∏ö‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á" },
            { nl: "druk", en: "busy", phonetic: "druk", thai: "‡∏¢‡∏∏‡πà‡∏á" },
            { nl: "nooit", en: "never", phonetic: "noyt", thai: "‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢" },
            { nl: "werken", en: "to work", phonetic: "VER-kun", thai: "‡∏ó‡∏≥‡∏á‡∏≤‡∏ô" },
            { nl: "'s ochtends", en: "in the morning", phonetic: "SOKH-tunts", thai: "‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤" },
            { nl: "'s middags", en: "in the afternoon", phonetic: "SMID-dakhs", thai: "‡∏ï‡∏≠‡∏ô‡∏ö‡πà‡∏≤‡∏¢" },
            { nl: "'s avonds", en: "in the evening", phonetic: "SAH-vonts", thai: "‡∏ï‡∏≠‡∏ô‡∏´‡∏Å‡πÇ‡∏°‡∏á‡πÄ‡∏¢‡πá‡∏ô‡∏ñ‡∏∂‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏∑‡∏ô" },
            { nl: "'s nachts", en: "at night", phonetic: "SNAKHTS", thai: "‡∏ï‡∏≠‡∏ô‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏∑‡∏ô‡∏ñ‡∏∂‡∏á‡∏´‡∏Å‡πÇ‡∏°‡∏á‡πÄ‡∏ä‡πâ‡∏≤" },
            { nl: "agenda", en: "diary / planner", phonetic: "ah-KHEN-dah", thai: "‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏û‡∏Å", note: "de agenda" },
          ],
          dialogues: [
            { situation: "Talking about a work schedule (Les 25)", lines: [
              { speaker: "A", nl: "Wanneer werk je?", en: "When do you work?" },
              { speaker: "B", nl: "Ik werk maandag tot en met vrijdag.", en: "I work Monday through Friday." },
              { speaker: "A", nl: "En in het weekend?", en: "And on the weekend?" },
              { speaker: "B", nl: "In het weekend hoef ik nooit te werken!", en: "On the weekend I never have to work!" },
            ]}
          ],
          grammar: {
            title: "Days of the Week & Time of Day",
            explanation: "Like months, Dutch days are <strong>not capitalized</strong>. Time of day uses a special construction: <strong>'s ochtends</strong> (in the morning), <strong>'s middags</strong> (in the afternoon), <strong>'s avonds</strong> (in the evening). The <em>'s</em> is an old genitive form. All days end in <em>-dag</em> (day).",
            examples: [
              { nl: "Op maandag werk ik", en: "On Monday I work" },
              { nl: "'s Ochtends ga ik naar school", en: "In the morning I go to school" },
              { nl: "Ik ben 's avonds thuis", en: "I'm home in the evening" },
            ]
          },
          exercises: [
            { type: "mc", question: "Which day comes after 'woensdag'?", answer: "donderdag", options: ["dinsdag", "donderdag", "vrijdag", "maandag"] },
            { type: "mc", question: "What does ''s avonds' mean?", answer: "in the evening", options: ["in the morning", "in the afternoon", "in the evening", "at night"] },
            { type: "mc", question: "'Nooit' means...?", answer: "never", options: ["always", "sometimes", "never", "often"] },
            { type: "mc", question: "The weekend is...?", answer: "zaterdag en zondag", options: ["vrijdag en zaterdag", "zaterdag en zondag", "zondag en maandag", "donderdag en vrijdag"] },
            { type: "mc", question: "Fill in: Ik ___ maandag tot vrijdag.", answer: "werk", options: ["ga", "werk", "ben", "heb"] },
          ]
        },
        {
          id: "t4b", title: "Hoe Laat Is Het?", titleEn: "What Time Is It?", titleTh: "‡∏Å‡∏µ‡πà‡πÇ‡∏°‡∏á‡πÅ‡∏•‡πâ‡∏ß?",
          vocab: [
            { nl: "hoe laat", en: "what time", phonetic: "hoo LAHT", thai: "‡∏Å‡∏µ‡πà‡πÇ‡∏°‡∏á" },
            { nl: "uur", en: "hour / o'clock", phonetic: "uhr", thai: "‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á", note: "het uur" },
            { nl: "half", en: "half", phonetic: "half", thai: "‡∏Ñ‡∏£‡∏∂‡πà‡∏á" },
            { nl: "kwart", en: "quarter", phonetic: "kvart", thai: "‡∏™‡∏¥‡∏ö‡∏´‡πâ‡∏≤‡∏ô‡∏≤‡∏ó‡∏µ" },
            { nl: "voor", en: "before / to", phonetic: "vohr", thai: "‡∏Å‡πà‡∏≠‡∏ô" },
            { nl: "over", en: "past / after", phonetic: "OH-vur", thai: "‡∏´‡∏•‡∏±‡∏á" },
            { nl: "begint", en: "starts", phonetic: "buh-KHINT", thai: "‡πÄ‡∏£‡∏¥‡πà‡∏°", note: "from: beginnen" },
            { nl: "klaar", en: "finished / ready", phonetic: "klahr", thai: "‡πÄ‡∏™‡∏£‡πá‡∏à" },
            { nl: "laat", en: "late", phonetic: "laht", thai: "‡∏™‡∏≤‡∏¢" },
            { nl: "minuut", en: "minute", phonetic: "mee-NUWT", thai: "‡∏ô‡∏≤‡∏ó‡∏µ", note: "de minuut" },
            { nl: "klok", en: "clock", phonetic: "klok", thai: "‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤", note: "de klok" },
            { nl: "wanneer", en: "when", phonetic: "van-NAYR", thai: "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏£" },
            { nl: "tussen", en: "between", phonetic: "TUS-sun", thai: "‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á" },
            { nl: "middag", en: "afternoon / noon", phonetic: "MID-dakh", thai: "‡∏ö‡πà‡∏≤‡∏¢", note: "de middag" },
            { nl: "tot", en: "until", phonetic: "tot", thai: "‡∏ñ‡∏∂‡∏á" },
          ],
          dialogues: [
            { situation: "Asking about time at school", lines: [
              { speaker: "A", nl: "Hoe laat begint de les?", en: "What time does the lesson start?" },
              { speaker: "B", nl: "Om half negen.", en: "At half past eight." },
              { speaker: "A", nl: "En wanneer zijn we klaar?", en: "And when are we finished?" },
              { speaker: "B", nl: "Om kwart voor een.", en: "At a quarter to one." },
            ]}
          ],
          grammar: {
            title: "Telling Time in Dutch ‚Äî ‚ö†Ô∏è Different from English!",
            explanation: "<strong>Half</strong> in Dutch refers to the NEXT hour, not the current one! <em>Half negen</em> = 8:30 (half of the way to nine). <em>Kwart over een</em> = 1:15. <em>Kwart voor twee</em> = 1:45. This is the #1 mistake for learners!",
            examples: [
              { nl: "Het is drie uur", en: "It's 3:00" },
              { nl: "Het is kwart over drie", en: "It's 3:15" },
              { nl: "Het is half vier", en: "It's 3:30 (NOT 4:30!)" },
              { nl: "Het is kwart voor vier", en: "It's 3:45" },
            ]
          },
          exercises: [
            { type: "mc", question: "What time is 'half zes'?", answer: "5:30", options: ["6:30", "5:30", "5:00", "6:00"] },
            { type: "mc", question: "'Kwart over twee' means...?", answer: "2:15", options: ["1:45", "2:00", "2:15", "2:45"] },
            { type: "mc", question: "What does 'klaar' mean?", answer: "finished / ready", options: ["late", "clear", "finished / ready", "early"] },
            { type: "mc", question: "'Kwart voor drie' is...?", answer: "2:45", options: ["3:15", "2:45", "3:45", "2:15"] },
            { type: "mc", question: "How do you say 7:30?", answer: "half acht", options: ["half zeven", "half acht", "zeven uur", "kwart over zeven"] },
          ]
        }
      ]
    },
    // ===== Theme 5: Eten & Drinken (Les 26) =====
    {
      id: 5, section: "taal", title: "Eten & Drinken", titleEn: "Food & Drinks", titleTh: "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°", icon: "üçΩÔ∏è", color: "#C73E1D",
      source: "Les 26",
      lessons: [
        {
          id: "t5a", title: "Aan Tafel", titleEn: "At the Table", titleTh: "‡∏ó‡∏µ‡πà‡πÇ‡∏ï‡πä‡∏∞‡∏≠‡∏≤‡∏´‡∏≤‡∏£",
          vocab: [
            { nl: "eten", en: "food / to eat", phonetic: "AY-tun", thai: "‡∏≠‡∏≤‡∏´‡∏≤‡∏£ / ‡∏Å‡∏¥‡∏ô", note: "het eten (noun)" },
            { nl: "drinken", en: "drinks / to drink", phonetic: "DRING-kun", thai: "‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏° / ‡∏î‡∏∑‡πà‡∏°" },
            { nl: "tafel", en: "table", phonetic: "TAH-ful", thai: "‡πÇ‡∏ï‡πä‡∏∞", note: "de tafel" },
            { nl: "stoel", en: "chair", phonetic: "stool", thai: "‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ", note: "de stoel" },
            { nl: "raam", en: "window", phonetic: "rahm", thai: "‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á", note: "het raam" },
            { nl: "broodje", en: "bread roll / sandwich", phonetic: "BROHT-yuh", thai: "‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡πÄ‡∏•‡πá‡∏Å‡πÜ", note: "het broodje" },
            { nl: "kaas", en: "cheese", phonetic: "kahs", thai: "‡∏ä‡∏µ‡∏™", note: "de kaas ‚Äî very Dutch! üßÄ" },
            { nl: "honger", en: "hunger", phonetic: "HONG-ur", thai: "‡∏´‡∏¥‡∏ß" },
            { nl: "lekker", en: "tasty / delicious", phonetic: "LEK-kur", thai: "‡∏≠‡∏£‡πà‡∏≠‡∏¢" },
            { nl: "soep", en: "soup", phonetic: "soop", thai: "‡∏ã‡∏∏‡∏õ", note: "de soep" },
            { nl: "vlees", en: "meat", phonetic: "vlays", thai: "‡πÄ‡∏ô‡∏∑‡πâ‡∏≠", note: "het vlees" },
            { nl: "melk", en: "milk", phonetic: "melk", thai: "‡∏ô‡∏°", note: "de melk" },
            { nl: "glas", en: "glass", phonetic: "khlas", thai: "‡πÅ‡∏Å‡πâ‡∏ß", note: "het glas" },
            { nl: "water", en: "water", phonetic: "VAH-tur", thai: "‡∏ô‡πâ‡∏≥", note: "het water" },
            { nl: "koffie", en: "coffee", phonetic: "KOF-fee", thai: "‡∏Å‡∏≤‡πÅ‡∏ü", note: "de koffie" },
            { nl: "thee", en: "tea", phonetic: "tay", thai: "‡∏ä‡∏≤", note: "de thee" },
            { nl: "nemen", en: "to take / have", phonetic: "NAY-mun", thai: "‡πÄ‡∏≠‡∏≤" },
            { nl: "geld", en: "money", phonetic: "khelt", thai: "‡πÄ‡∏á‡∏¥‡∏ô", note: "het geld" },
            { nl: "betalen", en: "to pay", phonetic: "buh-TAH-lun", thai: "‡∏à‡πà‡∏≤‡∏¢" },
            { nl: "samen", en: "together", phonetic: "SAH-mun", thai: "‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô" },
            { nl: "zoveel", en: "so much", phonetic: "zoh-VAYL", thai: "‡∏°‡∏≤‡∏Å" },
            { nl: "anders", en: "otherwise / different", phonetic: "AN-durs", thai: "‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô" },
            { nl: "niets", en: "nothing", phonetic: "neets", thai: "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£" },
            { nl: "iets", en: "something", phonetic: "eets", thai: "‡∏≠‡∏∞‡πÑ‡∏£" },
          ],
          dialogues: [
            { situation: "At a caf√© ordering food (Les 26)", lines: [
              { speaker: "A", nl: "Zullen we iets eten? Laten we aan die tafel zitten.", en: "Shall we eat something? Let's sit at that table." },
              { speaker: "B", nl: "Goed. Ik neem een broodje kaas.", en: "Good. I'll have a cheese sandwich." },
              { speaker: "A", nl: "En ik heb zin in een kop soep.", en: "And I feel like a cup of soup." },
              { speaker: "B", nl: "Wil je ook iets drinken? Een glas melk?", en: "Do you want something to drink too? A glass of milk?" },
              { speaker: "A", nl: "Nee, een kopje koffie graag.", en: "No, a cup of coffee please." },
            ]}
          ],
          grammar: {
            title: "'Zin hebben in' & Food Ordering",
            explanation: "<strong>Zin hebben in</strong> means 'to feel like' / 'to want': <em>Ik heb zin in soep</em> (I feel like soup). For ordering: <strong>Ik neem...</strong> (I'll have...) or <strong>Mag ik...</strong> (May I have...). Note: <em>een kop soep</em> (a cup of soup) vs <em>een kopje koffie</em> (a small cup of coffee). The '-je' suffix makes things small (diminutive).",
            examples: [
              { nl: "Ik heb zin in een broodje", en: "I feel like a sandwich" },
              { nl: "Ik neem een glas water", en: "I'll have a glass of water" },
              { nl: "Wil je iets drinken?", en: "Do you want something to drink?" },
            ]
          },
          exercises: [
            { type: "mc", question: "How do you say 'I feel like soup'?", answer: "Ik heb zin in soep", options: ["Ik wil soep", "Ik heb zin in soep", "Ik neem soep", "Ik eet soep"] },
            { type: "mc", question: "What is 'het broodje'?", answer: "bread roll / sandwich", options: ["bread roll / sandwich", "croissant", "cake", "biscuit"] },
            { type: "mc", question: "'Lekker' means...?", answer: "tasty", options: ["hungry", "tasty", "expensive", "hot"] },
            { type: "mc", question: "Fill in: Ik neem een ___ water.", answer: "glas", options: ["kop", "glas", "kopje", "fles"] },
            { type: "mc", question: "How do you ask for the bill?", answer: "Mag ik betalen?", options: ["Mag ik geld?", "Ik wil geld", "Mag ik betalen?", "Geld alsjeblieft?"] },
          ]
        },
        {
          id: "t5b", title: "Maaltijden", titleEn: "Meals of the Day", titleTh: "‡∏°‡∏∑‡πâ‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£",
          vocab: [
            { nl: "ontbijt", en: "breakfast", phonetic: "ont-BEYT", thai: "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏ä‡πâ‡∏≤", note: "het ontbijt" },
            { nl: "lunch", en: "lunch", phonetic: "lunch", thai: "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô", note: "de lunch" },
            { nl: "brood", en: "bread", phonetic: "broht", thai: "‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á", note: "het brood" },
            { nl: "boter", en: "butter", phonetic: "BOH-tur", thai: "‡πÄ‡∏ô‡∏¢‡∏ó‡∏≤", note: "de boter" },
            { nl: "ei", en: "egg", phonetic: "ey", thai: "‡πÑ‡∏Ç‡πà", note: "het ei" },
            { nl: "gebakken", en: "fried / baked", phonetic: "khuh-BAK-kun", thai: "‡∏ó‡∏≠‡∏î" },
            { nl: "vis", en: "fish", phonetic: "vis", thai: "‡∏õ‡∏•‡∏≤", note: "de vis" },
            { nl: "kip", en: "chicken", phonetic: "kip", thai: "‡πÑ‡∏Å‡πà", note: "de kip" },
            { nl: "groente", en: "vegetables", phonetic: "KHROON-tuh", thai: "‡∏ú‡∏±‡∏Å", note: "de groente" },
            { nl: "aardappelen", en: "potatoes", phonetic: "AHR-dah-puh-lun", thai: "‡∏°‡∏±‡∏ô‡∏ù‡∏£‡∏±‡πà‡∏á", note: "de aardappel ‚Äî Dutch staple!" },
            { nl: "thuis", en: "at home", phonetic: "tows", thai: "‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô" },
            { nl: "gezin", en: "family (nuclear)", phonetic: "khuh-ZIN", thai: "‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß", note: "het gezin" },
            { nl: "meestal", en: "usually", phonetic: "MAYS-tal", thai: "‡∏™‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å" },
            { nl: "collega's", en: "colleagues", phonetic: "kol-LAY-khahs", thai: "‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô" },
            { nl: "kopje", en: "small cup", phonetic: "KOP-yuh", thai: "‡∏ñ‡πâ‡∏ß‡∏¢‡πÄ‡∏•‡πá‡∏Å", note: "het kopje ‚Äî diminutive of kop" },
          ],
          dialogues: [
            { situation: "Describing daily meals (Les 26)", lines: [
              { speaker: "A", nl: "Wat eet je voor ontbijt?", en: "What do you eat for breakfast?" },
              { speaker: "B", nl: "Brood met boter en kaas, en een kopje thee.", en: "Bread with butter and cheese, and a cup of tea." },
              { speaker: "A", nl: "En 's avonds? Eet je thuis met het gezin?", en: "And in the evening? Do you eat at home with the family?" },
              { speaker: "B", nl: "Ja, meestal vis of kip met groente en aardappelen.", en: "Yes, usually fish or chicken with vegetables and potatoes." },
            ]}
          ],
          grammar: {
            title: "Dutch Meal Structure & Diminutives (-je)",
            explanation: "Dutch meals: <strong>ontbijt</strong> (breakfast) is bread-based. <strong>Lunch</strong> is also bread! <strong>Het avondeten</strong> (dinner) is the warm meal. The <strong>-je</strong> suffix makes things small/cute: <em>kop ‚Üí kopje</em>, <em>brood ‚Üí broodje</em>. This is one of the most-used features of Dutch!",
            examples: [
              { nl: "een kopje koffie", en: "a small cup of coffee" },
              { nl: "een broodje kaas", en: "a cheese sandwich (small bread)" },
              { nl: "vis met aardappelen en groente", en: "fish with potatoes and vegetables" },
            ]
          },
          exercises: [
            { type: "mc", question: "What is a typical Dutch breakfast?", answer: "Brood met kaas", options: ["Rijst met vis", "Brood met kaas", "Soep met vlees", "Gebakken ei met kip"] },
            { type: "mc", question: "'Aardappelen' are...?", answer: "potatoes", options: ["apples", "oranges", "potatoes", "pears"] },
            { type: "mc", question: "The diminutive of 'kop' is...?", answer: "kopje", options: ["koppen", "kopje", "kopje's", "kleine kop"] },
            { type: "mc", question: "Where does a Dutch family usually eat dinner?", answer: "thuis", options: ["in een restaurant", "thuis", "op school", "bij collega's"] },
            { type: "mc", question: "What does 'meestal' mean?", answer: "usually", options: ["always", "never", "usually", "sometimes"] },
          ]
        }
      ]
    },
    // ===== Themes 6-21: PLACEHOLDERS =====
    {
      id: 6, section: "taal", title: "De Dag", titleEn: "The Day", titleTh: "‡∏Å‡∏¥‡∏à‡∏ß‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô", icon: "üåÖ", color: "#888",
      source: "Les 27", comingSoon: true,
      lessons: []
    },
    {
      id: 7, section: "taal", title: "Familie & Buren", titleEn: "Family & Neighbors", titleTh: "‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ö‡πâ‡∏≤‡∏ô", icon: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶", color: "#888",
      source: "Les 28", comingSoon: true,
      lessons: []
    },
    {
      id: 8, section: "taal", title: "Gezondheid", titleEn: "Health", titleTh: "‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û", icon: "üè•", color: "#888",
      source: "Les 29, 35", comingSoon: true,
      lessons: []
    },
    {
      id: 9, section: "taal", title: "Vervoer", titleEn: "Transport", titleTh: "‡∏Å‡∏≤‡∏£‡∏Ç‡∏ô‡∏™‡πà‡∏á", icon: "üö≤", color: "#888",
      source: "Les 30, 49-51", comingSoon: true,
      lessons: []
    },
    {
      id: 10, section: "taal", title: "Op Reis", titleEn: "Travelling", titleTh: "‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á", icon: "‚úàÔ∏è", color: "#888",
      source: "Les 31, 62", comingSoon: true,
      lessons: []
    },
    {
      id: 11, section: "taal", title: "Weekend & Feest", titleEn: "Weekend & Celebrations", titleTh: "‡∏™‡∏∏‡∏î‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏â‡∏•‡∏≠‡∏á", icon: "üéâ", color: "#888",
      source: "Les 32, 55", comingSoon: true,
      lessons: []
    },
    {
      id: 12, section: "taal", title: "Taal Leren", titleEn: "Learning Dutch", titleTh: "‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏î‡∏±‡∏ï‡∏ä‡πå", icon: "üìö", color: "#888",
      source: "Les 33, 45-46", comingSoon: true,
      lessons: []
    },
    {
      id: 13, section: "taal", title: "Boodschappen", titleEn: "Shopping", titleTh: "‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á", icon: "üõí", color: "#888",
      source: "Les 34, 53, 59", comingSoon: true,
      lessons: []
    },
    {
      id: 14, section: "taal", title: "Gezin & Opvoeding", titleEn: "Family & Parenting", titleTh: "‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏î‡∏π", icon: "üë∂", color: "#888",
      source: "Les 36-38", comingSoon: true,
      lessons: []
    },
    {
      id: 15, section: "taal", title: "Sport & Vrije Tijd", titleEn: "Sports & Leisure", titleTh: "‡∏Å‡∏µ‡∏¨‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ß‡πà‡∏≤‡∏á", icon: "‚öΩ", color: "#888",
      source: "Les 39-40, 56", comingSoon: true,
      lessons: []
    },
    {
      id: 16, section: "taal", title: "Communicatie", titleEn: "Communication", titleTh: "‡∏Å‡∏≤‡∏£‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£", icon: "üì±", color: "#888",
      source: "Les 41, 48", comingSoon: true,
      lessons: []
    },
    {
      id: 17, section: "taal", title: "Op Bezoek", titleEn: "Visiting", titleTh: "‡∏Å‡∏≤‡∏£‡πÑ‡∏õ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°", icon: "üè°", color: "#888",
      source: "Les 42-44", comingSoon: true,
      lessons: []
    },
    {
      id: 18, section: "taal", title: "Werk", titleEn: "Work & Jobs", titleTh: "‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏ä‡∏µ‡∏û", icon: "üíº", color: "#888",
      source: "Les 47, 52", comingSoon: true,
      lessons: []
    },
    {
      id: 19, section: "taal", title: "Nederland Ontdekken", titleEn: "Discovering NL", titleTh: "‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÄ‡∏ô‡πÄ‡∏ò‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏ô‡∏î‡πå", icon: "üó∫Ô∏è", color: "#888",
      source: "Les 54, 57, 60-61", comingSoon: true,
      lessons: []
    },
    {
      id: 20, section: "taal", title: "Gewoontes & Regels", titleEn: "Customs & Rules", titleTh: "‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏Å‡∏é", icon: "üìã", color: "#888",
      source: "Les 58, 63-64", comingSoon: true,
      lessons: []
    },
    {
      id: 21, section: "taal", title: "Afscheid", titleEn: "Farewell", titleTh: "‡∏Å‡∏≤‡∏£‡∏≠‡∏≥‡∏•‡∏≤", icon: "üëã", color: "#888",
      source: "Les 65", comingSoon: true,
      lessons: []
    },
    // ===== SECTION B: KNS ‚Äî Placeholders =====
    {
      id: 22, section: "kns", title: "Geografie, Vervoer & Wonen", titleEn: "Geography, Transport & Housing", titleTh: "‡∏†‡∏π‡∏°‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏ç‡∏à‡∏£ ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏≤‡∏®‡∏±‡∏¢", icon: "üó∫Ô∏è", color: "#E85D26",
      comingSoon: true, lessons: []
    },
    {
      id: 23, section: "kns", title: "Geschiedenis", titleEn: "History", titleTh: "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", icon: "üìú", color: "#E85D26",
      comingSoon: true, lessons: []
    },
    {
      id: 24, section: "kns", title: "Staatsinrichting & Grondwet", titleEn: "Government & Constitution", titleTh: "‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ê‡∏ò‡∏£‡∏£‡∏°‡∏ô‡∏π‡∏ç", icon: "üèõÔ∏è", color: "#E85D26",
      comingSoon: true, lessons: []
    },
    {
      id: 25, section: "kns", title: "Nederlandse Taal", titleEn: "Dutch Language", titleTh: "‡∏†‡∏≤‡∏©‡∏≤‡∏î‡∏±‡∏ï‡∏ä‡πå", icon: "üó£Ô∏è", color: "#E85D26",
      comingSoon: true, lessons: []
    },
    {
      id: 26, section: "kns", title: "Opvoeding & Onderwijs", titleEn: "Parenting & Education", titleTh: "‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏î‡∏π‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤", icon: "üéì", color: "#E85D26",
      comingSoon: true, lessons: []
    },
    {
      id: 27, section: "kns", title: "Gezondheidszorg", titleEn: "Healthcare", titleTh: "‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û", icon: "‚öïÔ∏è", color: "#E85D26",
      comingSoon: true, lessons: []
    },
    {
      id: 28, section: "kns", title: "Werk & Inkomen", titleEn: "Work & Income", titleTh: "‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ", icon: "üí∂", color: "#E85D26",
      comingSoon: true, lessons: []
    },
    // ===== SECTION C: UITSPRAAK ‚Äî Placeholder =====
    {
      id: 29, section: "uitspraak", title: "Nederlandse Klanken", titleEn: "Dutch Sounds", titleTh: "‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏†‡∏≤‡∏©‡∏≤‡∏î‡∏±‡∏ï‡∏ä‡πå", icon: "üîä", color: "#5E9B4E",
      comingSoon: true, lessons: []
    },
    {
      id: 30, section: "uitspraak", title: "Klinkers & Medeklinkers", titleEn: "Vowels & Consonants", titleTh: "‡∏™‡∏£‡∏∞‡πÅ‡∏•‡∏∞‡∏û‡∏¢‡∏±‡∏ç‡∏ä‡∏ô‡∏∞", icon: "üî§", color: "#5E9B4E",
      comingSoon: true, lessons: []
    }
  ]
};

// ============================================================
// APP STATE & RENDERING
// ============================================================
let state = {
  view: 'home', // home | module | lesson
  currentModule: null,
  currentLesson: null,
  activeTab: 'vocab',
  exerciseAnswers: {},
  showResults: false,
  completedLessons: JSON.parse(localStorage.getItem('dutchCompleted') || '{}'),
  showSearch: false,
  searchTerm: '',
  speechRate: 1.0,
  isPlaying: false,
  activeWordIdx: -1,
  ttsEngine: localStorage.getItem('dutchTTS') || 'auto', // 'auto', 'browser', or browser voice index
};

// ============================================================
// TTS ENGINE ‚Äî Using HTML5 Audio with Google TTS + Browser fallback
// ============================================================
let currentAudio = null;
let dutchBrowserVoices = [];
let playAborted = false;

// Discover browser Dutch voices
function initBrowserVoices() {
  if (!('speechSynthesis' in window)) return;
  const voices = speechSynthesis.getVoices();
  dutchBrowserVoices = voices.filter(v => v.lang === 'nl-NL' || v.lang === 'nl-BE' || v.lang.startsWith('nl'));
}
if ('speechSynthesis' in window) {
  speechSynthesis.onvoiceschanged = initBrowserVoices;
  initBrowserVoices();
  setTimeout(initBrowserVoices, 500);
  setTimeout(initBrowserVoices, 1500);
}

function getBrowserVoiceLabel(v) {
  let name = v.name.replace('Microsoft ', '').replace('Google ', '');
  const nl = v.lang === 'nl-BE' ? ' üáßüá™' : ' üá≥üá±';
  const cloud = v.localService ? '' : ' ‚òÅÔ∏è';
  const lo = v.name.toLowerCase();
  const fem = ['anna','fenna','lotte','sophie','ellen','colette','sara','maria','fleur','merel'];
  const mal = ['maarten','frank','willem','ruben','jan','joost','piet','bram','bas','daan'];
  let g = '';
  if (fem.some(n => lo.includes(n))) g = ' üë©';
  else if (mal.some(n => lo.includes(n))) g = ' üë®';
  return name + g + nl + cloud;
}

// Google Translate TTS ‚Äî produces real native Dutch speech
function googleTtsUrl(text, slow) {
  const speed = slow ? '0.24' : '1';
  // Google Translate TTS endpoint (publicly accessible, used by the translate widget)
  return `https://translate.google.com/translate_tts?ie=UTF-8&tl=nl&client=tw-ob&q=${encodeURIComponent(text)}&ttsspeed=${speed}`;
}

function stopAllAudio() {
  playAborted = true;
  if (currentAudio) {
    currentAudio.onended = null;
    currentAudio.onerror = null;
    currentAudio.ontimeupdate = null;
    currentAudio.pause();
    // Don't destroy unlockedAudio ‚Äî just stop it
    if (currentAudio === unlockedAudio) {
      currentAudio.src = '';
    }
    currentAudio = null;
  }
  if ('speechSynthesis' in window) speechSynthesis.cancel();
  state.isPlaying = false;
  state.activeWordIdx = -1;
  document.querySelectorAll('.listen-card').forEach(c => c.classList.remove('active-word'));
  document.querySelectorAll('.speak-btn').forEach(b => b.classList.remove('speaking'));
  document.querySelectorAll('.dialogue-line').forEach(c => { c.style.outline = 'none'; });
  const pb = document.getElementById('play-all-btn');
  if (pb) { pb.textContent = '‚ñ∂ Play All'; pb.style.background = '#fff'; }
  const db = document.getElementById('play-dialogue-btn');
  if (db) { db.textContent = '‚ñ∂ Play Dialogue'; db.style.background = '#fff'; }
}

// Low-level play function ‚Äî plays one text, calls onDone when finished
// Does NOT call stopAllAudio ‚Äî safe to call in a sequence
function playOneTTS(text, onDone) {
  // Clean up previous audio without aborting the sequence
  if (currentAudio) {
    currentAudio.onended = null;
    currentAudio.onerror = null;
    currentAudio.ontimeupdate = null;
    currentAudio.pause();
    currentAudio = null;
  }
  if ('speechSynthesis' in window) speechSynthesis.cancel();

  const engine = state.ttsEngine;

  // Browser voice path
  if (engine === 'browser-auto' || (engine !== 'auto' && typeof engine === 'string' && engine.startsWith('browser-'))) {
    const voiceIdx = engine === 'browser-auto' ? -1 : parseInt(engine.replace('browser-',''), 10);
    return playOneBrowser(text, voiceIdx, onDone);
  }

  // Google TTS path (default)
  // iOS Safari blocks new Audio().play() unless from a direct user gesture.
  // Strategy: try Google TTS, fall back to browser speech if it fails.
  const slow = state.speechRate < 0.7;
  const url = googleTtsUrl(text, slow);

  // Use the pre-unlocked audio element if available (iOS), otherwise create new
  const audio = unlockedAudio || new Audio();
  audio.src = url;
  currentAudio = audio;

  let done = false;
  function finish() {
    if (done) return;
    done = true;
    // Don't null out unlockedAudio ‚Äî we reuse it
    if (audio !== unlockedAudio) currentAudio = null;
    else currentAudio = null;
    if (onDone && !playAborted) onDone();
  }

  const safetyTimer = setTimeout(() => {
    if (!done && currentAudio === audio) {
      audio.pause();
      finish();
    }
  }, 10000);

  audio.onended = () => { clearTimeout(safetyTimer); finish(); };

  audio.onerror = () => {
    clearTimeout(safetyTimer);
    currentAudio = null;
    // Fall back to browser voice
    playOneBrowser(text, -1, onDone);
  };

  const playPromise = audio.play();
  if (playPromise && playPromise.catch) {
    playPromise.catch(() => {
      clearTimeout(safetyTimer);
      currentAudio = null;
      // Google TTS blocked (likely iOS) ‚Äî fall back to browser speech
      playOneBrowser(text, -1, onDone);
    });
  }
}

function playOneBrowser(text, voiceIdx, onDone) {
  if (!('speechSynthesis' in window)) { if (onDone) onDone(); return; }
  speechSynthesis.cancel();
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = 'nl-NL';
  utter.rate = state.speechRate;
  if (voiceIdx >= 0 && voiceIdx < dutchBrowserVoices.length) {
    utter.voice = dutchBrowserVoices[voiceIdx];
  } else if (dutchBrowserVoices.length > 0) {
    // Auto-select: prefer female nl-NL voice, then any nl-NL, then first available
    const femaleNames = ['ellen','fenna','lotte','sophie','colette','sara','maria','fleur','merel','anna','claire'];
    const best = dutchBrowserVoices.find(v => v.lang === 'nl-NL' && femaleNames.some(f => v.name.toLowerCase().includes(f)))
      || dutchBrowserVoices.find(v => v.lang === 'nl-NL' && !v.localService)
      || dutchBrowserVoices.find(v => femaleNames.some(f => v.name.toLowerCase().includes(f)))
      || dutchBrowserVoices.find(v => v.lang === 'nl-NL')
      || dutchBrowserVoices[0];
    if (best) utter.voice = best;
  }
  let done = false;
  const safetyTimer = setTimeout(() => { if (!done) { done = true; if (onDone && !playAborted) onDone(); } }, 10000);
  utter.onend = () => { clearTimeout(safetyTimer); if (!done) { done = true; if (onDone && !playAborted) onDone(); } };
  // iOS fix: speechSynthesis can get stuck in paused state
  if (speechSynthesis.paused) speechSynthesis.resume();
  speechSynthesis.speak(utter);
}

// =================================================================
// iOS Audio Unlock
// =================================================================
// iOS Safari requires the very first Audio.play() to happen inside
// a direct user-gesture (touchend/click). We create a single Audio
// element and "unlock" it on the first tap anywhere on the page.
// After that, we can reuse it with .src = newUrl and .play() works.
let unlockedAudio = null;
let audioUnlocked = false;

function unlockAudio() {
  if (audioUnlocked) return;
  audioUnlocked = true;

  // Create and unlock an Audio element with a silent data URI
  const silentDataUri = 'data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAAAAAAAAAAAAYYAAAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAAAAAAAAAAAAYYAAAAAAAAAAAAAAAAA';
  unlockedAudio = new Audio();
  unlockedAudio.src = silentDataUri;
  const p = unlockedAudio.play();
  if (p && p.catch) p.catch(() => {});

  // Also wake up speechSynthesis on iOS
  if ('speechSynthesis' in window) {
    const wake = new SpeechSynthesisUtterance('');
    wake.volume = 0;
    speechSynthesis.speak(wake);
  }

  document.removeEventListener('touchend', unlockAudio, true);
  document.removeEventListener('click', unlockAudio, true);
}

// Listen for first user interaction
document.addEventListener('touchend', unlockAudio, true);
document.addEventListener('click', unlockAudio, true);

// Also detect iOS to auto-switch to browser voices if Google TTS fails
const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
if (isIOS && state.ttsEngine === 'auto') {
  // On iOS, Google TTS often fails due to CORS ‚Äî default to browser
  state.ttsEngine = 'browser-auto';
  localStorage.setItem('dutchTTS', 'browser-auto');
}

// High-level speak ‚Äî for single word clicks (stops everything first)
function speakDutch(text) {
  stopAllAudio();
  playAborted = false;
  playOneTTS(text, null);
}

function speakAndHighlight(btn, text) {
  stopAllAudio();
  playAborted = false;
  document.querySelectorAll('.speak-btn').forEach(b => b.classList.remove('speaking'));
  if (btn) btn.classList.add('speaking');
  playOneTTS(text, () => { if (btn) btn.classList.remove('speaking'); });
}

function stopPlayAll() { stopAllAudio(); }

function playAllWords() {
  if (state.isPlaying) { stopPlayAll(); return; }
  if (!state.currentLesson) return;
  const words = state.currentLesson.vocab;
  state.isPlaying = true;
  playAborted = false;
  const pb = document.getElementById('play-all-btn');
  if (pb) { pb.textContent = '‚èπ Stop'; pb.style.background = '#FFEBEE'; }

  function playNext(idx) {
    if (playAborted || !state.isPlaying || idx >= words.length) { stopPlayAll(); return; }
    state.activeWordIdx = idx;
    document.querySelectorAll('.listen-card').forEach((c,i) => c.classList.toggle('active-word', i === idx));
    const ac = document.querySelectorAll('.listen-card')[idx];
    if (ac) ac.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    playOneTTS(words[idx].nl, () => { setTimeout(() => playNext(idx+1), 600); });
  }
  playNext(0);
}

function playDialogue() {
  if (state.isPlaying) { stopPlayAll(); return; }
  if (!state.currentLesson) return;
  const allLines = [];
  state.currentLesson.dialogues.forEach(d => d.lines.forEach(l => allLines.push(l.nl)));
  state.isPlaying = true;
  playAborted = false;
  const db = document.getElementById('play-dialogue-btn');
  if (db) { db.textContent = '‚èπ Stop'; db.style.background = '#FFEBEE'; }

  function playNext(idx) {
    if (playAborted || !state.isPlaying || idx >= allLines.length) { stopPlayAll(); return; }
    document.querySelectorAll('.dialogue-line').forEach((c,i) => {
      c.style.outline = i === idx ? '2px solid #2E86AB' : 'none';
      c.style.outlineOffset = i === idx ? '2px' : '0';
    });
    const ae = document.querySelectorAll('.dialogue-line')[idx];
    if (ae) ae.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    playOneTTS(allLines[idx], () => { setTimeout(() => playNext(idx+1), 500); });
  }
  playNext(0);
}

function setSpeed(rate) {
  state.speechRate = rate;
  document.querySelectorAll('.speed-btn').forEach(b => {
    b.classList.toggle('active-speed', parseFloat(b.dataset.rate) === rate);
  });
}

function setTtsEngine(val) {
  state.ttsEngine = val;
  localStorage.setItem('dutchTTS', val);
  // Play test so user hears the difference
  speakDutch('Hallo, dit is uw nieuwe Nederlandse stem.');
}

function resetProgress() {
  if (confirm('Weet je het zeker? / Are you sure you want to reset all progress?')) {
    state.completedLessons = {};
    localStorage.removeItem('dutchCompleted');
    render();
  }
}

function setState(updates) {
  // Stop speech when navigating
  if (updates.view || updates.currentLesson !== undefined || updates.activeTab) {
    stopAllAudio();
  }
  Object.assign(state, updates);
  render();
}

function saveCompleted() {
  localStorage.setItem('dutchCompleted', JSON.stringify(state.completedLessons));
}

function getAllVocab() {
  const all = [];
  COURSE_DATA.modules.forEach(m => m.lessons.forEach(l => l.vocab.forEach(v => all.push({...v, module: m.title, lesson: l.title}))));
  return all;
}

function escHtml(s) {
  const d = document.createElement('div');
  d.textContent = s;
  return d.innerHTML;
}

// ============================================================
// RENDER FUNCTIONS
// ============================================================
function render() {
  const app = document.getElementById('app');
  if (state.view === 'home') app.innerHTML = renderHome();
  else if (state.view === 'settings') app.innerHTML = renderSettings();
  else if (state.view === 'module') app.innerHTML = renderModule();
  else if (state.view === 'lesson') app.innerHTML = renderLesson();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function renderHome() {
  const activeMods = COURSE_DATA.modules.filter(m => !m.comingSoon);
  const totalLessons = activeMods.reduce((s,m) => s + m.lessons.length, 0);
  const completedCount = Object.keys(state.completedLessons).length;
  const pct = totalLessons > 0 ? (completedCount / totalLessons * 100) : 0;

  let searchHtml = '';
  if (state.showSearch) {
    const filtered = state.searchTerm.length > 1
      ? getAllVocab().filter(v => v.nl.toLowerCase().includes(state.searchTerm.toLowerCase()) || v.en.toLowerCase().includes(state.searchTerm.toLowerCase()) || (v.thai && v.thai.includes(state.searchTerm)))
      : [];
    searchHtml = `
      <input type="text" class="search-input" placeholder="Search in Dutch, English, or Thai..." value="${escHtml(state.searchTerm)}" oninput="setState({searchTerm: this.value})">
      ${filtered.length > 0 ? `<div class="search-results">${filtered.slice(0,15).map(v => `
        <div class="item"><strong>${escHtml(v.nl)}</strong> ‚Äî ${escHtml(v.en)} ${v.thai ? `<span style="color:#888">(${v.thai})</span>` : ''}
        <div class="detail">/${escHtml(v.phonetic)}/ ¬∑ ${escHtml(v.module)}</div></div>
      `).join('')}</div>` : ''}
    `;
  }

  // Render sections
  function renderSection(section) {
    const mods = COURSE_DATA.modules.filter(m => m.section === section.id);
    const sectionActive = mods.filter(m => !m.comingSoon);
    const sectionDone = sectionActive.reduce((s,m) => s + m.lessons.filter(l => state.completedLessons[l.id]).length, 0);
    const sectionTotal = sectionActive.reduce((s,m) => s + m.lessons.length, 0);
    const sectionWords = sectionActive.reduce((s,m) => s + m.lessons.reduce((s2,l) => s2 + l.vocab.length, 0), 0);

    return `
      <div class="section-block" style="margin-bottom:20px">
        <div style="display:flex;align-items:center;gap:10px;margin:20px 0 10px;padding-bottom:8px;border-bottom:3px solid ${section.color}">
          <span style="font-size:24px">${section.icon}</span>
          <div>
            <h2 class="serif" style="margin:0;font-size:20px;color:${section.color}">${section.title}</h2>
            <p style="margin:2px 0 0;font-size:13px;color:#888">${section.titleEn}${sectionWords > 0 ? ` ¬∑ ${sectionWords} words` : ''}${sectionTotal > 0 ? ` ¬∑ ${sectionDone}/${sectionTotal} lessons` : ''}</p>
          </div>
        </div>
        <p style="margin:0 0 12px;font-size:13px;color:#999">${section.descriptionTh || ''}</p>
        <div class="module-grid">
          ${mods.map(mod => {
            const idx = COURSE_DATA.modules.indexOf(mod);
            if (mod.comingSoon) {
              return `<div class="module-card" style="border-left:5px solid #ccc;opacity:0.55;cursor:default">
                <div class="icon" style="filter:grayscale(1)">${mod.icon}</div>
                <h3 class="serif" style="color:#999">${escHtml(mod.title)}</h3>
                <div class="en" style="color:#bbb">${escHtml(mod.titleEn)}</div>
                ${mod.source ? `<div style="font-size:11px;color:#ccc;margin-top:4px">${mod.source}</div>` : ''}
                <div class="meta" style="color:#ccc">Coming soon</div>
              </div>`;
            }
            const done = mod.lessons.filter(l => state.completedLessons[l.id]).length;
            const words = mod.lessons.reduce((s,l) => s + l.vocab.length, 0);
            return `<button class="module-card" style="border-left:5px solid ${mod.color}" onclick="setState({view:'module',currentModule:COURSE_DATA.modules[${idx}]})">
              <div class="icon">${mod.icon}</div>
              <h3 class="serif">${escHtml(mod.title)}</h3>
              <div class="en">${escHtml(mod.titleEn)}</div>
              ${mod.titleTh ? `<div style="font-size:12px;color:#999;margin-bottom:6px">${mod.titleTh}</div>` : ''}
              ${mod.source ? `<div style="font-size:11px;color:#bbb;margin-bottom:4px">${mod.source}</div>` : ''}
              <div class="meta" style="color:${mod.color}">${done}/${mod.lessons.length} lessons ¬∑ ${words} words</div>
            </button>`;
          }).join('')}
        </div>
      </div>
    `;
  }

  return `
    <div class="header">
      <button onclick="setState({view:'settings'})" style="position:absolute;top:16px;right:16px;background:rgba(255,255,255,0.2);border:none;border-radius:8px;padding:6px 10px;cursor:pointer;font-size:18px;color:#fff;z-index:2" title="Settings">‚öôÔ∏è</button>
      <div class="flag"><div></div><div></div><div></div></div>
      <h1 class="serif">Leer Nederlands</h1>
      <p class="sub">Dutch for Thai Speakers ¬∑ A1 Inburgering Preparation</p>
      <p class="sub2">‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏î‡∏±‡∏ï‡∏ä‡πå ¬∑ ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏≠‡∏ö Inburgering ‡∏£‡∏∞‡∏î‡∏±‡∏ö A1</p>
      <p style="margin:6px 0 0;font-size:11px;color:rgba(255,255,255,0.5)">v0.2</p>
    </div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <span style="font-weight:600;color:#333" class="serif">Your Progress ¬∑ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤</span>
        <div style="display:flex;align-items:center;gap:10px">
          <span style="color:#666;font-size:14px">${completedCount}/${totalLessons} lessons</span>
          ${completedCount > 0 ? `<button onclick="resetProgress()" style="background:none;border:1px solid #ddd;border-radius:6px;padding:4px 10px;font-size:12px;color:#999;cursor:pointer;font-family:inherit" title="Reset all progress">üîÑ Reset</button>` : ''}
        </div>
      </div>
      <div class="progress-bar"><div class="progress-fill" style="width:${pct}%"></div></div>
    </div>

    <button class="search-toggle" onclick="setState({showSearch:!state.showSearch})">
      üîç ${state.showSearch ? 'Hide' : 'Search'} Dictionary (${getAllVocab().length} words)
    </button>
    ${searchHtml}

    <div class="card-accent">
      <h3 style="margin:0 0 8px;color:#E85D26" class="serif">üìã About the Inburgering Exam</h3>
      <p style="margin:0;font-size:14px;line-height:1.6;color:#555">
        The <strong>Basisexamen Inburgering Buitenland</strong> has 3 parts: <strong>Leesvaardigheid</strong> (reading A1), 
        <strong>Spreekvaardigheid</strong> (speaking A1), and <strong>KNS</strong> (knowledge of Dutch society). 
        Based on the official <em>Naar Nederland</em> curriculum with 65 lessons.
      </p>
      <p style="margin:8px 0 0;font-size:13px;color:#888">
        ‡∏™‡∏≠‡∏ö Inburgering ‡∏°‡∏µ 3 ‡∏™‡πà‡∏ß‡∏ô: ‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô, ‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î, ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏î‡∏±‡∏ï‡∏ä‡πå (KNS)
      </p>
    </div>

    ${COURSE_DATA.sections.map(sec => renderSection(sec)).join('')}

    <div class="card-blue">
      <h3 style="margin:0 0 10px" class="serif">üí° Study Tips for Thai Speakers</h3>
      <p class="tip"><strong>1. Use your Thai throat sounds!</strong> Dutch 'g' and 'ch' are similar to Thai ‡∏Ñ ‚Äî you have a head start.</p>
      <p class="tip"><strong>2. Watch Dutch TV with subtitles.</strong> Try NPO Start (npostart.nl) ‚Äî it's free Dutch public TV.</p>
      <p class="tip"><strong>3. Practice compound words.</strong> Both Thai and Dutch love compound words ‚Äî break long words into parts!</p>
      <p class="tip"><strong>4. Focus on 'de' and 'het'.</strong> Always learn the article with the noun. There's no shortcut ‚Äî memorize them!</p>
      <p class="tip"><strong>5. Use the "Naar Nederland" app</strong> ‚Äî it's the official preparation tool for the exam.</p>
    </div>

    <div style="text-align:center;padding:24px 0 8px;border-top:1px solid #e8e8e8;margin-top:12px">
      <p style="margin:0 0 4px;font-size:13px;color:#999">by <strong style="color:#777">@trippledutch</strong> ‚Äî built with Claude</p>
      <p style="margin:0;font-size:12px;color:#bbb">v0.2 ¬∑ February 2026</p>
    </div>
  `;
}

function renderSettings() {
  const browserVoiceOptions = dutchBrowserVoices.map((v, i) =>
    `<option value="browser-${i}" ${state.ttsEngine === 'browser-'+i ? 'selected' : ''}>${escHtml(getBrowserVoiceLabel(v))}</option>`
  ).join('');

  const currentVoiceLabel = state.ttsEngine === 'auto' ? 'Google Dutch üåê'
    : state.ttsEngine === 'browser-auto' ? 'Auto-select female üë©'
    : state.ttsEngine.startsWith('browser-') ? (dutchBrowserVoices[parseInt(state.ttsEngine.replace('browser-',''),10)]?.name || 'Browser voice')
    : 'Unknown';

  return `
    <button class="back-btn" onclick="setState({view:'home'})">‚Üê Back to Home</button>
    <div style="padding:16px 0 12px;border-bottom:3px solid #21468B">
      <h2 class="serif" style="margin:0 0 2px">‚öôÔ∏è Settings ¬∑ ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h2>
      <p style="color:#666;margin:0">Configure your learning experience</p>
    </div>

    <div class="card" style="margin-top:20px">
      <h3 class="serif" style="margin:0 0 16px;color:#21468B">üéôÔ∏è Voice ¬∑ ‡πÄ‡∏™‡∏µ‡∏¢‡∏á</h3>

      <div style="margin-bottom:16px">
        <label style="font-weight:600;font-size:14px;color:#333;display:block;margin-bottom:8px">Dutch Voice Engine</label>
        <select id="voice-select" class="voice-select" onchange="setTtsEngine(this.value)">
          <option value="auto" ${state.ttsEngine === 'auto' ? 'selected' : ''}>üåê Google Dutch ‚Äî native speaker (desktop recommended)</option>
          ${dutchBrowserVoices.length > 0 ? `<optgroup label="‚îÄ‚îÄ Browser Voices (${dutchBrowserVoices.length} found) ‚îÄ‚îÄ">
            <option value="browser-auto" ${state.ttsEngine === 'browser-auto' ? 'selected' : ''}>üñ•Ô∏è Auto-select best female voice üë©</option>
            ${browserVoiceOptions}
          </optgroup>` : ''}
        </select>
        <div style="font-size:12px;color:#888;margin-top:6px;line-height:1.5">
          Current: <strong>${escHtml(currentVoiceLabel)}</strong><br>
          üåê Google = native speaker, needs internet ¬∑ üñ•Ô∏è Browser = works offline<br>
          üì± iPhone/iPad auto-uses browser voice (Google blocked by iOS)
        </div>
      </div>

      <div style="display:flex;align-items:center;gap:8px;margin-bottom:16px;flex-wrap:wrap">
        <button class="voice-test-btn" onclick="speakDutch('Hallo, ik ben uw Nederlandse stem. Hoe gaat het met u?')">üîä Test Greeting</button>
        <button class="voice-test-btn" onclick="speakDutch('Goedemorgen. Ik kom uit Thailand en ik woon in Nederland.')">üîä Test Sentence</button>
        <button class="voice-test-btn" onclick="speakDutch('Scheveningen is een mooie plek. De gracht is groot.')">üîä Test Hard Sounds</button>
        <button class="voice-test-btn" onclick="stopAllAudio()">‚èπ Stop</button>
      </div>

      <div style="margin-bottom:4px">
        <label style="font-weight:600;font-size:14px;color:#333;display:block;margin-bottom:8px">Speech Speed ¬∑ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß</label>
        <div style="display:flex;gap:6px;flex-wrap:wrap">
          ${[0.6, 1.0].map(r => `<button class="speed-btn ${state.speechRate === r ? 'active-speed' : ''}" data-rate="${r}" onclick="setSpeed(${r});render()">${r === 0.6 ? 'üê¢ Slow ‚Äî for learning' : 'üö∂ Normal speed'}</button>`).join('')}
        </div>
      </div>
    </div>

    <div class="card">
      <h3 class="serif" style="margin:0 0 16px;color:#21468B">üìä Progress ¬∑ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πâ‡∏≤‡∏ß‡∏´‡∏ô‡πâ‡∏≤</h3>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <span style="font-size:14px;color:#555">${Object.keys(state.completedLessons).length} of ${COURSE_DATA.modules.reduce((s,m) => s + m.lessons.length, 0)} lessons completed</span>
      </div>
      <div class="progress-bar" style="margin-bottom:16px"><div class="progress-fill" style="width:${(Object.keys(state.completedLessons).length / COURSE_DATA.modules.reduce((s,m) => s + m.lessons.length, 0) * 100)}%"></div></div>
      ${Object.keys(state.completedLessons).length > 0 ? `
        <button onclick="resetProgress()" style="background:#fff;border:2px solid #E74C3C;border-radius:8px;padding:10px 20px;font-size:14px;color:#E74C3C;cursor:pointer;font-family:inherit;font-weight:600;transition:all 0.2s">üîÑ Reset All Progress</button>
        <p style="font-size:12px;color:#999;margin:8px 0 0">This will clear all completed lessons. You'll start from scratch.</p>
      ` : `<p style="font-size:14px;color:#999">No lessons completed yet. Start learning!</p>`}
    </div>

    <div class="card">
      <h3 class="serif" style="margin:0 0 12px;color:#21468B">‚ÑπÔ∏è About</h3>
      <p style="font-size:14px;color:#555;line-height:1.6;margin:0 0 8px">
        A Dutch language course designed for Thai speakers preparing for the <strong>Basisexamen Inburgering Buitenland</strong> (A1 level).
        Covers vocabulary, dialogues, grammar, pronunciation, and Dutch society knowledge (KNS).
      </p>
      <p style="font-size:13px;color:#888;line-height:1.6;margin:0 0 12px">
        ‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£‡∏†‡∏≤‡∏©‡∏≤‡∏î‡∏±‡∏ï‡∏ä‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡πÑ‡∏ó‡∏¢ ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏≠‡∏ö Inburgering ‡∏£‡∏∞‡∏î‡∏±‡∏ö A1
        ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå ‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤ ‡πÑ‡∏ß‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏î‡∏±‡∏ï‡∏ä‡πå
      </p>
      <div style="border-top:1px solid #eee;padding-top:12px;text-align:center">
        <p style="margin:0 0 4px;font-size:13px;color:#999">by <strong style="color:#777">@trippledutch</strong> ‚Äî built with Claude</p>
        <p style="margin:0;font-size:12px;color:#bbb">v0.2 ¬∑ February 2026</p>
      </div>
    </div>
  `;
}

function renderModule() {
  const mod = state.currentModule;
  return `
    <button class="back-btn" onclick="setState({view:'home',currentModule:null})">‚Üê Back to Modules</button>
    <div class="module-header" style="border-left:5px solid ${mod.color}">
      <div class="icon">${mod.icon}</div>
      <h2 class="serif" style="margin:8px 0 2px">${escHtml(mod.title)}</h2>
      <p style="color:#666">${escHtml(mod.titleEn)}</p>
      ${mod.titleTh ? `<p style="color:#999;font-size:14px;margin-top:2px">${mod.titleTh}</p>` : ''}
      ${mod.source ? `<p style="color:#bbb;font-size:12px;margin-top:4px">üìñ ${mod.source}</p>` : ''}
    </div>
    <div class="lesson-list">
      ${mod.lessons.map((lesson, idx) => {
        const done = state.completedLessons[lesson.id];
        return `<button class="lesson-card" onclick="setState({view:'lesson',currentLesson:state.currentModule.lessons[${idx}],activeTab:'vocab',exerciseAnswers:{},showResults:false})">
          <div style="display:flex;align-items:center;gap:12px">
            <div class="num" style="background:${done ? '#5E9B4E' : mod.color}">${done ? '‚úì' : idx+1}</div>
            <div style="text-align:left">
              <div style="font-weight:600;color:#222;font-size:16px" class="serif">${escHtml(lesson.title)}</div>
              <div style="color:#666;font-size:13px">${escHtml(lesson.titleEn)} ${lesson.titleTh ? `¬∑ ${lesson.titleTh}` : ''} ¬∑ ${lesson.vocab.length} words</div>
            </div>
          </div>
          <span style="color:#bbb;font-size:20px">‚Üí</span>
        </button>`;
      }).join('')}
    </div>
  `;
}

function renderLesson() {
  const mod = state.currentModule;
  const lesson = state.currentLesson;
  const tab = state.activeTab;

  const tabs = [
    { key: 'vocab', label: 'üìö Vocabulary' },
    { key: 'listen', label: 'üîä Listen' },
    { key: 'dialogue', label: 'üí¨ Dialogue' },
    { key: 'grammar', label: 'üìê Grammar' },
    { key: 'practice', label: '‚úèÔ∏è Practice' },
  ];

  let content = '';
  if (tab === 'vocab') content = renderVocab(mod, lesson);
  else if (tab === 'listen') content = renderListen(mod, lesson);
  else if (tab === 'dialogue') content = renderDialogue(mod, lesson);
  else if (tab === 'grammar') content = renderGrammar(mod, lesson);
  else if (tab === 'practice') content = renderPractice(mod, lesson);

  return `
    <button class="back-btn" onclick="setState({view:'module',currentLesson:null})">‚Üê Back to ${escHtml(mod.title)}</button>
    <div style="padding:16px 0 12px;border-bottom:3px solid ${mod.color}">
      <h2 class="serif" style="margin:0 0 2px">${escHtml(lesson.title)}</h2>
      <p style="color:#666;margin:0">${escHtml(lesson.titleEn)} ${lesson.titleTh ? `¬∑ <span style="color:#999">${lesson.titleTh}</span>` : ''}</p>
    </div>
    <div class="tabs">
      ${tabs.map(t => `<button class="tab ${tab === t.key ? 'active' : ''}" style="${tab === t.key ? 'background:'+mod.color+';border-color:transparent' : ''}" onclick="setState({activeTab:'${t.key}'${t.key !== 'practice' ? ',showResults:false,exerciseAnswers:{}' : ''}})">${t.label}</button>`).join('')}
    </div>
    <div>${content}</div>
  `;
}

function renderVocab(mod, lesson) {
  return `
    <p style="color:#666;font-size:14px;margin:0 0 16px">Learn these words. Click üîä to hear pronunciation.</p>
    <div class="vocab-grid">
      ${lesson.vocab.map(v => `
        <div class="vocab-card">
          <div class="vocab-card-header">
            <div class="nl serif" style="color:${mod.color}">${escHtml(v.nl)}</div>
            <button class="speak-btn speak-btn-sm" onclick="speakAndHighlight(this,'${escHtml(v.nl).replace(/'/g,"\\'")}')">üîä</button>
          </div>
          <div class="phonetic">/${escHtml(v.phonetic)}/</div>
          <div class="en">${escHtml(v.en)}</div>
          ${v.thai ? `<div class="thai">${v.thai}</div>` : ''}
          ${v.note ? `<div class="note">${escHtml(v.note)}</div>` : ''}
        </div>
      `).join('')}
    </div>
  `;
}

function renderListen(mod, lesson) {
  return `
    <div class="listen-controls">
      <button id="play-all-btn" class="listen-btn" style="border-color:${mod.color};color:${mod.color};background:#fff" onclick="playAllWords()">‚ñ∂ Play All</button>
      <button class="listen-btn" style="border-color:#888;color:#555;background:#fff" onclick="stopPlayAll()">‚èπ Stop</button>
      <div class="speed-control">
        <span style="font-size:13px;color:#666;font-weight:600">Speed:</span>
        ${[0.6, 1.0].map(r => `<button class="speed-btn ${state.speechRate === r ? 'active-speed' : ''}" data-rate="${r}" onclick="setSpeed(${r})">${r === 0.6 ? 'üê¢ Slow' : 'üö∂ Normal'}</button>`).join('')}
      </div>
    </div>
    <p style="color:#666;font-size:14px;margin:0 0 12px">Click any word to hear it, or use "Play All" to listen through the entire list. ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ü‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á</p>
    <div class="listen-list">
      ${lesson.vocab.map((v, i) => `
        <div class="listen-card" onclick="speakAndHighlight(this.querySelector('.speak-btn'),'${escHtml(v.nl).replace(/'/g,"\\'")}')">
          <button class="speak-btn" onclick="event.stopPropagation();speakAndHighlight(this,'${escHtml(v.nl).replace(/'/g,"\\'")}')">üîä</button>
          <div style="flex:1;min-width:0">
            <div style="display:flex;align-items:baseline;gap:8px;flex-wrap:wrap">
              <span class="serif" style="font-size:18px;font-weight:700;color:${mod.color}">${escHtml(v.nl)}</span>
              <span style="font-size:13px;color:#888">/${escHtml(v.phonetic)}/</span>
            </div>
            <div style="font-size:14px;color:#555;margin-top:2px">${escHtml(v.en)} ${v.thai ? `<span style="color:#999">¬∑ ${v.thai}</span>` : ''}</div>
          </div>
        </div>
      `).join('')}
    </div>
    <div style="margin-top:20px">
      <h4 class="serif" style="color:${mod.color};margin:0 0 12px">üé≠ Listen to the Dialogue ¬∑ ‡∏ü‡∏±‡∏á‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤</h4>
      ${lesson.dialogues.map(d => `
        <div style="background:#fff;border-radius:12px;padding:16px;box-shadow:0 1px 3px rgba(0,0,0,0.05)">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <span style="font-weight:600;color:#555">${escHtml(d.situation)}</span>
            <button id="play-dialogue-btn" class="listen-btn" style="border-color:${mod.color};color:${mod.color};background:#fff;padding:8px 14px;font-size:13px" onclick="playDialogue()">‚ñ∂ Play Dialogue</button>
          </div>
          ${d.lines.map(l => `
            <div class="dialogue-line ${l.speaker === 'You' ? 'you' : 'other'}" style="${l.speaker === 'You' ? 'border-left-color:'+mod.color : ''};cursor:pointer" onclick="speakDutch('${escHtml(l.nl).replace(/'/g,"\\'")}')">
              <div class="speaker" style="color:${l.speaker === 'You' ? mod.color : '#888'}">${escHtml(l.speaker)}</div>
              <div class="nl-text serif">${escHtml(l.nl)}</div>
              <div class="en-text">${escHtml(l.en)}</div>
            </div>
          `).join('')}
        </div>
      `).join('')}
    </div>
  `;
}

function renderDialogue(mod, lesson) {
  return lesson.dialogues.map(d => `
    <div class="dialogue-box" style="--mod-color:${mod.color}">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <h3 style="margin:0;color:${mod.color}" class="serif">üé≠ ${escHtml(d.situation)}</h3>
        <button id="play-dialogue-btn" class="listen-btn" style="border-color:${mod.color};color:${mod.color};background:#fff;padding:8px 14px;font-size:13px" onclick="playDialogue()">‚ñ∂ Play Full Dialogue</button>
      </div>
      ${d.lines.map(l => {
        const isYou = l.speaker === 'You';
        return `<div class="dialogue-line ${isYou ? 'you' : 'other'}" style="${isYou ? '--mod-color:'+mod.color+';border-left-color:'+mod.color : ''}">
          <div class="dialogue-line-header">
            <div class="speaker" style="color:${isYou ? mod.color : '#888'}">${escHtml(l.speaker)}</div>
            <button class="speak-btn speak-btn-sm" onclick="speakAndHighlight(this,'${escHtml(l.nl).replace(/'/g,"\\'")}')">üîä</button>
          </div>
          <div class="nl-text serif">${escHtml(l.nl)}</div>
          <div class="en-text">${escHtml(l.en)}</div>
        </div>`;
      }).join('')}
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
        <p style="font-size:13px;color:#999;margin:0;font-style:italic">üí° Try reading the Dutch lines out loud before looking at the English!</p>
        <div class="speed-control">
          <span style="font-size:12px;color:#888">Speed:</span>
          ${[0.6, 1.0].map(r => `<button class="speed-btn ${state.speechRate === r ? 'active-speed' : ''}" data-rate="${r}" onclick="setSpeed(${r})">${r === 0.6 ? 'üê¢' : 'üö∂'}</button>`).join('')}
        </div>
      </div>
    </div>
  `).join('');
}

function renderGrammar(mod, lesson) {
  const g = lesson.grammar;
  if (!g) return '<p>No grammar notes for this lesson.</p>';
  return `
    <div class="grammar-box">
      <h3 style="margin:0 0 12px;color:${mod.color}" class="serif">${escHtml(g.title)}</h3>
      <p style="font-size:15px;line-height:1.7;color:#444;margin:0 0 20px">${g.explanation}</p>
      ${g.examples.map(ex => `
        <div class="grammar-example" style="cursor:pointer" onclick="speakDutch('${escHtml(ex.nl).replace(/'/g,"\\'")}')">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div class="nl serif">${escHtml(ex.nl)}</div>
            <button class="speak-btn speak-btn-sm" onclick="event.stopPropagation();speakAndHighlight(this,'${escHtml(ex.nl).replace(/'/g,"\\'")}')">üîä</button>
          </div>
          <div class="en">${escHtml(ex.en)}</div>
        </div>
      `).join('')}
    </div>
  `;
}

function renderPractice(mod, lesson) {
  const answers = state.exerciseAnswers;
  const show = state.showResults;
  const allAnswered = Object.keys(answers).length >= lesson.exercises.length;

  let scoreHtml = '';
  if (show) {
    const correct = lesson.exercises.filter((ex,i) => answers[i] === ex.answer).length;
    const total = lesson.exercises.length;
    const passed = correct >= total * 0.6;
    scoreHtml = `
      <div class="score-card ${passed ? 'pass' : 'fail'}">
        <div class="score serif">${correct}/${total}</div>
        <div class="msg">${correct === total ? 'üéâ Perfect! Uitstekend!' : passed ? '‚úÖ Good job! Goed gedaan! Lesson completed.' : 'üìñ Keep practicing! Probeer het nog een keer!'}</div>
        ${correct < total ? `<button class="retry-btn" style="background:${mod.color}" onclick="setState({exerciseAnswers:{},showResults:false})">Try Again</button>` : ''}
      </div>
    `;
  }

  return `
    ${scoreHtml}
    ${lesson.exercises.map((ex, idx) => {
      const selected = answers[idx];
      const isCorrect = show && selected === ex.answer;
      const isWrong = show && selected && selected !== ex.answer;
      return `
        <div class="exercise-card ${show ? (isCorrect ? 'correct' : isWrong ? 'wrong' : '') : ''}">
          <div class="question serif">${idx+1}. ${escHtml(ex.question)}</div>
          <div class="options-grid" style="--mod-color:${mod.color}">
            ${ex.options.map(opt => {
              const isSel = selected === opt;
              const optCorrect = show && opt === ex.answer;
              const optWrong = show && isSel && opt !== ex.answer;
              let cls = 'option-btn';
              if (isSel && !show) cls += ' selected';
              if (optCorrect) cls += ' opt-correct';
              if (optWrong) cls += ' opt-wrong';
              return `<button class="${cls}" style="--mod-color:${mod.color}" ${show ? 'disabled' : ''} onclick="selectAnswer(${idx},'${escHtml(opt).replace(/'/g,"\\'")}')">
                ${escHtml(opt)}${optCorrect ? ' ‚úì' : ''}${optWrong ? ' ‚úó' : ''}
              </button>`;
            }).join('')}
          </div>
        </div>
      `;
    }).join('')}
    ${!show ? `<button class="check-btn" style="background:${allAnswered ? mod.color : '#ccc'}" ${allAnswered ? '' : 'disabled'} onclick="checkAnswers()">Check Answers ¬∑ Controleer</button>` : ''}
  `;
}

// ============================================================
// EVENT HANDLERS
// ============================================================
function selectAnswer(idx, answer) {
  if (state.showResults) return;
  state.exerciseAnswers = {...state.exerciseAnswers, [idx]: answer};
  render();
}

function checkAnswers() {
  state.showResults = true;
  const lesson = state.currentLesson;
  const correct = lesson.exercises.filter((ex,i) => state.exerciseAnswers[i] === ex.answer).length;
  if (correct >= lesson.exercises.length * 0.6) {
    state.completedLessons = {...state.completedLessons, [lesson.id]: true};
    saveCompleted();
  }
  render();
}

// Initial render
render();
</script>
</body>
</html>
